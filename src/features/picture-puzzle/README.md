# Picture Puzzle（ピクチャーパズル）

## 概要

画像をスライドパズルとして並び替えるクラシックなパズルゲーム。
6 つのテーマから画像を選び、2x2 ～ 32x32 の 9 段階の難易度でパズルを楽しめる。
マウスクリック・キーボード・スワイプの 3 種類の操作に対応し、スコアリング＆ランクシステムでやり込み要素を提供する。

## 操作方法

### マウス

- 空白に隣接するピースをクリックしてスライド移動

### キーボード

| キー | アクション |
|------|-----------|
| `↑` / `W` | ピースを上にスライド |
| `↓` / `S` | ピースを下にスライド |
| `←` / `A` | ピースを左にスライド |
| `→` / `D` | ピースを右にスライド |
| `H` | ヒント表示の切替 |
| `R` | パズルをリセット（再シャッフル） |

### タッチ（モバイル）

- ボード上でスワイプしてピースをスライド（閾値 30px）
- タップでクリックと同じ操作

## 主な機能

### テーマコレクション

6 つのテーマ（計 15 枚の画像）を収録。クリア回数やテーマ制覇に応じてテーマがアンロックされる。

| テーマ | アンロック条件 |
|--------|---------------|
| イラストギャラリー | 初期解放 |
| 世界の風景 | 初期解放 |
| 懐かしの風景 | 累計 5 回クリア |
| 海と空 | 累計 10 回クリア |
| 四季の彩り | 3 テーマをクリア |
| ミステリー | 全テーマをクリア |

### 難易度

| レベル | 分割数 | ピース数 |
|--------|--------|---------|
| 簡単 | 2x2 | 4 |
| 初級 | 3x3 | 9 |
| 普通（デフォルト） | 4x4 | 16 |
| 中級 | 5x5 | 25 |
| 難しい | 6x6 | 36 |
| 上級 | 8x8 | 64 |
| エキスパート | 10x10 | 100 |
| マスター | 16x16 | 256 |
| 超難関 | 32x32 | 1,024 |

### スコアリング＆ランクシステム

クリア時にスコアが計算され、ランクが付与される。

- **基本スコア**: 10,000 点
- **手数ペナルティ**: 最適手数を超えた 1 手あたり -50 点
- **時間ペナルティ**: 1 秒あたり -10 点
- **ヒントペナルティ**: ヒント使用時 -1,000 点
- **難易度倍率**: 分割数に応じた倍率を乗算

| ランク | 必要スコア |
|--------|-----------|
| ★★★ | 8,000 以上 |
| ★★☆ | 5,000 以上 |
| ★☆☆ | 2,000 以上 |
| クリア | 2,000 未満 |

### アニメーション

- **紙吹雪エフェクト**: クリア時に 30 個の紙吹雪が降る
- **ボーダーディゾルブ**: クリア時にピースの境界線が中心から外側へ段階的に消失
- **完成画像フェードイン**: ディゾルブ完了後に完成画像がフェードイン
- **正解フラッシュ**: ピースが正しい位置に置かれた時に緑色にフラッシュ
- **タイトル画面グロー**: タイトル文字がシアンに脈動

### その他

- **ヒント表示**: 完成画像を半透明で重ねて表示
- **動画再生**: クリア後、対応する画像の動画をボード内で再生（6 枚対応）
- **リザルト画面**: スコア・ランク・タイム・手数を表示、SNS シェア対応
- **クリア履歴**: ベストスコアとクリア履歴を 2 タブで確認可能
- **データ永続化**: localStorage にベストスコア・クリア履歴・累計クリア数を保存

## 技術詳細

### ファイル構成

```
src/
  pages/PuzzlePage.tsx                    # ページコンポーネント
  pages/PuzzlePage.styles.ts             # ページスタイル
  components/TitleScreen.tsx              # タイトル画面
  components/PuzzleSections.tsx           # セットアップ・ゲーム画面
  components/organisms/
    PuzzleBoard.tsx                       # パズルボード（メインゲーム画面）
    PuzzleBoard.styles.ts                # ボードスタイル・アニメーション
  components/molecules/
    PuzzlePiece.tsx                       # パズルピース
    PuzzlePiece.styles.ts               # ピーススタイル・アニメーション
    ThemeSelector.tsx                     # テーマ選択 UI
    DifficultySelector.tsx               # 難易度選択 UI
    ResultScreen.tsx                      # リザルト画面
    ClearHistoryList.tsx                  # クリア履歴表示
    ShareButton.tsx                       # SNS シェアボタン
  hooks/
    useGameState.ts                       # ゲーム状態管理
    usePuzzle.ts                          # パズルロジック
    useHintMode.ts                        # ヒントモード
    useKeyboard.ts                        # キーボード操作
    useSwipe.ts                           # スワイプ操作
    useCompletionOverlay.ts              # リザルトオーバーレイ
    useVideoPlayback.ts                  # 動画再生
  store/atoms.ts                          # Jotai アトム（状態管理）
  types/puzzle.ts                         # 型定義
  data/themes.ts                          # テーマ・画像データ
  utils/
    puzzle-utils.ts                       # パズルユーティリティ
    storage-utils.ts                      # ストレージユーティリティ
    score-utils.ts                        # スコア計算・ランク判定
```

### 状態管理

- **Jotai** によるアトムベースの状態管理
- `useGameState` でゲームフェーズ（タイトル → セットアップ → プレイ → クリア）を管理
- `usePuzzle` でパズルロジック（シャッフル・移動判定・完成判定・タイマー）を管理

### 使用技術

- **CSS Grid**: パズルピースの配置
- **styled-components**: テーマ対応のコンポーネントスタイル（CSS 変数によるダークテーマ）
- **localStorage**: クリア履歴・ベストスコア・テーマアンロック状態の永続化
- **Touch Events**: スワイプ操作の実装
- **CSS Animations / Keyframes**: クリア演出（紙吹雪・ディゾルブ・フェードイン）
