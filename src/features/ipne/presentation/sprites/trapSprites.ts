/**
 * 罠スプライト定義
 *
 * ゲーム内の各種罠（ダメージ罠、減速罠、テレポート罠）の
 * 16x16 ドット絵スプライトを定義する。
 * 各罠は2フレームのアニメーション（隠れ状態 / 発動状態）を持つ。
 */

import { SpriteDefinition } from './spriteData';
import { SpriteSheetDefinition } from './spriteSheet';

// ---------------------------------------------------------------------------
// ダメージ罠（赤いトゲ）
// ---------------------------------------------------------------------------

/**
 * ダメージ罠パレット
 * 0: 透明
 * 1: 最も暗い赤 (#7f1d1d)
 * 2: 暗い赤 (#991b1b)
 * 3: 赤 (#dc2626)
 * 4: 明るい赤 (#f87171)
 * 5: 暗い床色 (#1f2937)
 */
const DAMAGE_TRAP_PALETTE: string[] = [
  '',
  '#7f1d1d',
  '#991b1b',
  '#dc2626',
  '#f87171',
  '#1f2937',
];

/**
 * ダメージ罠 フレーム1: 隠れ状態（トゲが収納されている）
 * 床色を基調とし、うっすらと罠の輪郭が見える
 */
const DAMAGE_TRAP_FRAME_1: SpriteDefinition = {
  width: 16,
  height: 16,
  palette: DAMAGE_TRAP_PALETTE,
  pixels: [
    // y=0:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=1:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=2:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=3:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=4:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=5:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=6:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=7:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=8:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=9:  床面
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=10: トゲの先端がわずかに見える
    [0, 0, 0, 5, 0, 0, 5, 0, 0, 5, 0, 0, 5, 0, 0, 0],
    // y=11: トゲ上部のかすかな影
    [0, 0, 5, 1, 5, 5, 1, 5, 5, 1, 5, 5, 1, 5, 0, 0],
    // y=12: ベースプレート上部（溝）
    [0, 5, 5, 1, 5, 5, 1, 5, 5, 1, 5, 5, 1, 5, 5, 0],
    // y=13: ベースプレート（金属板のライン）
    [0, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 0],
    // y=14: ベースプレート下部
    [0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0],
    // y=15: 床面
    [0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0],
  ],
};

/**
 * ダメージ罠 フレーム2: 発動状態（トゲが飛び出し赤く光る）
 * 鋭いトゲが上方向に突き出し、赤く輝く
 */
const DAMAGE_TRAP_FRAME_2: SpriteDefinition = {
  width: 16,
  height: 16,
  palette: DAMAGE_TRAP_PALETTE,
  pixels: [
    // y=0:  トゲの最先端（光る）
    [0, 0, 0, 4, 0, 0, 4, 0, 0, 4, 0, 0, 4, 0, 0, 0],
    // y=1:  トゲ先端
    [0, 0, 0, 3, 0, 0, 3, 0, 0, 3, 0, 0, 3, 0, 0, 0],
    // y=2:  トゲ上部
    [0, 0, 4, 3, 4, 4, 3, 4, 4, 3, 4, 4, 3, 4, 0, 0],
    // y=3:  トゲ中上部
    [0, 0, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 0, 0],
    // y=4:  トゲ中部
    [0, 0, 3, 2, 3, 3, 2, 3, 3, 2, 3, 3, 2, 3, 0, 0],
    // y=5:  トゲ中部（太くなる）
    [0, 3, 2, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 0],
    // y=6:  トゲ中下部
    [0, 3, 2, 1, 2, 3, 1, 2, 3, 1, 2, 3, 1, 2, 3, 0],
    // y=7:  トゲ下部
    [0, 2, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 0],
    // y=8:  トゲ根元上部
    [0, 2, 1, 1, 1, 2, 1, 1, 2, 1, 1, 2, 1, 1, 2, 0],
    // y=9:  トゲ根元
    [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0],
    // y=10: ベースとの接合部
    [0, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 2, 1, 1, 0],
    // y=11: ベースプレート上部
    [0, 5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5, 0],
    // y=12: ベースプレートの溝（開いた状態）
    [5, 5, 2, 0, 2, 5, 2, 0, 5, 2, 0, 5, 2, 0, 5, 5],
    // y=13: ベースプレート（金属板）
    [5, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 5],
    // y=14: ベースプレート下部
    [0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0],
    // y=15: 床面
    [0, 0, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 0, 0],
  ],
};

/** ダメージ罠スプライトシート（2フレームアニメーション） */
export const DAMAGE_TRAP_SPRITE_SHEET: SpriteSheetDefinition = {
  sprites: [DAMAGE_TRAP_FRAME_1, DAMAGE_TRAP_FRAME_2],
  frameDuration: 200,
};

// ---------------------------------------------------------------------------
// 減速罠（青い蜘蛛の巣）
// ---------------------------------------------------------------------------

/**
 * 減速罠パレット
 * 0: 透明
 * 1: 暗い青 (#1e3a5f)
 * 2: 青 (#3b82f6)
 * 3: 明るい青 (#60a5fa)
 * 4: 最も明るい青 (#93c5fd)
 * 5: 暗い床色 (#1f2937)
 */
const SLOW_TRAP_PALETTE: string[] = [
  '',
  '#1e3a5f',
  '#3b82f6',
  '#60a5fa',
  '#93c5fd',
  '#1f2937',
];

/**
 * 減速罠 フレーム1: 隠れ状態（うっすらとした蜘蛛の巣）
 * 放射状の糸と接続糸がかすかに見える
 */
const SLOW_TRAP_FRAME_1: SpriteDefinition = {
  width: 16,
  height: 16,
  palette: SLOW_TRAP_PALETTE,
  pixels: [
    // y=0:  外周の糸（左上から右上へ）
    [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
    // y=1:  放射糸（対角線）
    [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0],
    // y=2:  放射糸
    [0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0],
    // y=3:  接続糸（外側のリング）
    [0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
    // y=4:  放射糸と接続糸の交点
    [0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0],
    // y=5:  接続糸（中間リング）
    [0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0],
    // y=6:  中心に近い放射糸
    [0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0],
    // y=7:  中心（蜘蛛の巣の中央）
    [1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1],
    // y=8:  中心から下への放射糸
    [0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0],
    // y=9:  接続糸（中間リング下）
    [0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0],
    // y=10: 放射糸と接続糸の交点
    [0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0],
    // y=11: 接続糸（外側のリング下）
    [0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0],
    // y=12: 放射糸
    [0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0],
    // y=13: 放射糸（対角線）
    [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0],
    // y=14: 外周の糸
    [0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0],
    // y=15: 外周最下
    [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0],
  ],
};

/**
 * 減速罠 フレーム2: 発動状態（蜘蛛の巣が光って可視化される）
 * 太い糸が青く光り、放射状パターンが明確になる
 */
const SLOW_TRAP_FRAME_2: SpriteDefinition = {
  width: 16,
  height: 16,
  palette: SLOW_TRAP_PALETTE,
  pixels: [
    // y=0:  外周の糸（光る）
    [3, 0, 0, 0, 0, 0, 2, 3, 2, 0, 0, 0, 0, 0, 0, 3],
    // y=1:  放射糸（対角線 光る）
    [0, 2, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 2, 0, 0],
    // y=2:  放射糸
    [0, 0, 3, 0, 0, 0, 0, 2, 0, 0, 0, 0, 3, 0, 0, 0],
    // y=3:  接続糸（外側のリング 光る）
    [0, 0, 0, 2, 3, 3, 2, 3, 2, 3, 3, 2, 0, 0, 0, 0],
    // y=4:  放射糸と接続糸の交点
    [0, 0, 0, 3, 0, 0, 2, 0, 2, 0, 0, 3, 0, 0, 0, 0],
    // y=5:  接続糸（中間リング 光る）
    [0, 0, 0, 3, 0, 3, 4, 3, 4, 3, 0, 3, 0, 0, 0, 0],
    // y=6:  中心に近い放射糸
    [2, 0, 0, 2, 0, 4, 0, 3, 0, 4, 0, 2, 0, 0, 2, 0],
    // y=7:  中心（蜘蛛の巣の中央 最も光る）
    [3, 2, 3, 3, 3, 3, 3, 4, 3, 3, 3, 3, 3, 3, 2, 3],
    // y=8:  中心から下への放射糸
    [2, 0, 0, 2, 0, 4, 0, 3, 0, 4, 0, 2, 0, 0, 2, 0],
    // y=9:  接続糸（中間リング下 光る）
    [0, 0, 0, 3, 0, 3, 4, 3, 4, 3, 0, 3, 0, 0, 0, 0],
    // y=10: 放射糸と接続糸の交点
    [0, 0, 0, 3, 0, 0, 2, 0, 2, 0, 0, 3, 0, 0, 0, 0],
    // y=11: 接続糸（外側のリング下 光る）
    [0, 0, 0, 2, 3, 3, 2, 3, 2, 3, 3, 2, 0, 0, 0, 0],
    // y=12: 放射糸
    [0, 0, 3, 0, 0, 0, 0, 2, 0, 0, 0, 0, 3, 0, 0, 0],
    // y=13: 放射糸（対角線）
    [0, 2, 0, 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 2, 0, 0],
    // y=14: 外周の糸
    [2, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 2, 0],
    // y=15: 外周最下
    [3, 0, 0, 0, 0, 0, 2, 3, 2, 0, 0, 0, 0, 0, 0, 3],
  ],
};

/** 減速罠スプライトシート（2フレームアニメーション） */
export const SLOW_TRAP_SPRITE_SHEET: SpriteSheetDefinition = {
  sprites: [SLOW_TRAP_FRAME_1, SLOW_TRAP_FRAME_2],
  frameDuration: 300,
};

// ---------------------------------------------------------------------------
// テレポート罠（紫の渦巻き）
// ---------------------------------------------------------------------------

/**
 * テレポート罠パレット
 * 0: 透明
 * 1: 最も暗い紫 (#4c1d95)
 * 2: 暗い紫 (#6b21a8)
 * 3: 紫 (#7c3aed)
 * 4: 明るい紫 (#a78bfa)
 * 5: 最も明るい紫 (#c4b5fd)
 */
const TELEPORT_TRAP_PALETTE: string[] = [
  '',
  '#4c1d95',
  '#6b21a8',
  '#7c3aed',
  '#a78bfa',
  '#c4b5fd',
];

/**
 * テレポート罠 フレーム1: 渦巻き状態A
 * 中心から外側に向かって時計回りの渦巻きパターン
 */
const TELEPORT_TRAP_FRAME_1: SpriteDefinition = {
  width: 16,
  height: 16,
  palette: TELEPORT_TRAP_PALETTE,
  pixels: [
    // y=0:  外周上部
    [0, 0, 0, 0, 0, 1, 1, 2, 2, 1, 1, 0, 0, 0, 0, 0],
    // y=1:  外周
    [0, 0, 0, 1, 1, 2, 2, 3, 3, 2, 2, 1, 1, 0, 0, 0],
    // y=2:  渦の外輪 上
    [0, 0, 1, 2, 3, 3, 0, 0, 0, 0, 3, 3, 2, 1, 0, 0],
    // y=3:  渦の外輪
    [0, 1, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 2, 1, 0],
    // y=4:  渦の中間輪 上
    [0, 1, 3, 0, 0, 2, 3, 4, 4, 3, 2, 0, 0, 3, 1, 0],
    // y=5:  渦の中間輪
    [1, 2, 0, 0, 2, 3, 4, 4, 5, 4, 3, 2, 0, 0, 2, 1],
    // y=6:  内側の渦 上
    [1, 2, 0, 0, 3, 4, 0, 0, 0, 0, 4, 3, 0, 0, 2, 1],
    // y=7:  中心付近（最も明るい部分）
    [2, 3, 0, 0, 4, 5, 0, 5, 4, 0, 5, 4, 0, 0, 3, 2],
    // y=8:  中心付近
    [2, 3, 0, 0, 4, 4, 0, 4, 5, 0, 5, 4, 0, 0, 3, 2],
    // y=9:  内側の渦 下
    [1, 2, 0, 0, 3, 4, 0, 0, 0, 0, 4, 3, 0, 0, 2, 1],
    // y=10: 渦の中間輪 下
    [1, 2, 0, 0, 2, 3, 4, 5, 4, 4, 3, 2, 0, 0, 2, 1],
    // y=11: 渦の中間輪
    [0, 1, 3, 0, 0, 2, 3, 4, 4, 3, 2, 0, 0, 3, 1, 0],
    // y=12: 渦の外輪 下
    [0, 1, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 2, 1, 0],
    // y=13: 渦の外輪
    [0, 0, 1, 2, 3, 3, 0, 0, 0, 0, 3, 3, 2, 1, 0, 0],
    // y=14: 外周
    [0, 0, 0, 1, 1, 2, 2, 3, 3, 2, 2, 1, 1, 0, 0, 0],
    // y=15: 外周下部
    [0, 0, 0, 0, 0, 1, 1, 2, 2, 1, 1, 0, 0, 0, 0, 0],
  ],
};

/**
 * テレポート罠 フレーム2: 渦巻き状態B（少し回転した状態）
 * フレーム1から渦巻きが回転し、交互表示でスピン効果を生む
 */
const TELEPORT_TRAP_FRAME_2: SpriteDefinition = {
  width: 16,
  height: 16,
  palette: TELEPORT_TRAP_PALETTE,
  pixels: [
    // y=0:  外周上部
    [0, 0, 0, 0, 0, 1, 2, 2, 1, 1, 0, 0, 0, 0, 0, 0],
    // y=1:  外周
    [0, 0, 0, 1, 2, 2, 3, 3, 2, 2, 1, 1, 0, 0, 0, 0],
    // y=2:  渦の外輪 上（回転済み）
    [0, 0, 1, 2, 3, 0, 0, 0, 0, 0, 3, 3, 2, 1, 0, 0],
    // y=3:  渦の外輪
    [0, 1, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 2, 1, 0, 0],
    // y=4:  渦の中間輪 上（回転済み）
    [0, 2, 0, 0, 2, 3, 4, 4, 3, 2, 0, 0, 0, 3, 1, 0],
    // y=5:  渦の中間輪
    [1, 2, 0, 2, 3, 4, 5, 4, 4, 3, 2, 0, 0, 0, 2, 1],
    // y=6:  内側の渦 上（回転済み）
    [2, 3, 0, 3, 4, 0, 0, 0, 0, 4, 3, 0, 0, 0, 2, 1],
    // y=7:  中心付近
    [2, 3, 0, 4, 5, 0, 4, 5, 0, 5, 4, 0, 0, 0, 3, 2],
    // y=8:  中心付近
    [2, 3, 0, 0, 4, 5, 0, 5, 4, 0, 5, 4, 0, 0, 3, 2],
    // y=9:  内側の渦 下（回転済み）
    [1, 2, 0, 0, 3, 4, 0, 0, 0, 0, 4, 3, 0, 3, 2, 1],
    // y=10: 渦の中間輪 下（回転済み）
    [1, 2, 0, 0, 0, 2, 3, 4, 4, 5, 4, 3, 2, 0, 2, 1],
    // y=11: 渦の中間輪
    [0, 1, 3, 0, 0, 0, 2, 3, 4, 4, 3, 2, 0, 0, 1, 0],
    // y=12: 渦の外輪 下（回転済み）
    [0, 0, 1, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 3, 1, 0],
    // y=13: 渦の外輪
    [0, 0, 1, 2, 3, 3, 0, 0, 0, 0, 0, 3, 3, 2, 0, 0],
    // y=14: 外周
    [0, 0, 0, 0, 1, 1, 2, 3, 3, 2, 2, 1, 1, 0, 0, 0],
    // y=15: 外周下部
    [0, 0, 0, 0, 0, 0, 1, 1, 2, 2, 1, 1, 0, 0, 0, 0],
  ],
};

/** テレポート罠スプライトシート（2フレームアニメーション） */
export const TELEPORT_TRAP_SPRITE_SHEET: SpriteSheetDefinition = {
  sprites: [TELEPORT_TRAP_FRAME_1, TELEPORT_TRAP_FRAME_2],
  frameDuration: 250,
};

// ---------------------------------------------------------------------------
// ヘルパー関数
// ---------------------------------------------------------------------------

/**
 * 罠タイプ文字列からスプライトシートを取得するヘルパー関数
 *
 * @param trapType - 罠のタイプ（'damage', 'slow', 'teleport'）
 * @returns 対応する SpriteSheetDefinition
 * @throws 不明な罠タイプが指定された場合にエラーをスロー
 */
export function getTrapSpriteSheet(trapType: string): SpriteSheetDefinition {
  switch (trapType) {
    case 'damage':
      return DAMAGE_TRAP_SPRITE_SHEET;
    case 'slow':
      return SLOW_TRAP_SPRITE_SHEET;
    case 'teleport':
      return TELEPORT_TRAP_SPRITE_SHEET;
    default:
      throw new Error(`不明な罠タイプです: ${trapType}`);
  }
}
