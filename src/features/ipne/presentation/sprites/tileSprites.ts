/**
 * タイルスプライト定義
 *
 * ゲームマップを構成するタイル（床、壁、ゴール、スタート）の
 * 16×16 ピクセルアートスプライトをコードスプライト方式で定義する。
 */

import { SpriteDefinition } from './spriteData';
import { SpriteSheetDefinition } from './spriteSheet';
import { StageNumber } from '../../types';

// ---------------------------------------------------------------------------
// 床タイル（石畳パターン）
// ---------------------------------------------------------------------------
// パレット:
//   0 = 透明
//   1 = #1a202c（最も暗い - 目地・溝）
//   2 = #1f2937（暗い - 石のベース色）
//   3 = #2d3748（やや明るい - 石のハイライト・エッジ）
// ---------------------------------------------------------------------------

/** 床タイルのパレット */
const FLOOR_PALETTE = ['', '#1a202c', '#1f2937', '#2d3748'];

/** 床タイルのピクセルデータ（16×16） - 石畳模様 */
const FLOOR_PIXELS: number[][] = [
  // y=0:  上端の目地ライン
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
  // y=1:  石ブロック A 行（8px 幅の石が2つ）
  [1, 3, 2, 2, 2, 2, 3, 1, 1, 3, 2, 2, 2, 2, 3, 1],
  // y=2
  [1, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1],
  // y=3
  [1, 2, 2, 3, 2, 2, 2, 1, 1, 2, 2, 2, 3, 2, 2, 1],
  // y=4
  [1, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1],
  // y=5
  [1, 3, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 3, 1],
  // y=6
  [1, 2, 2, 2, 2, 3, 2, 1, 1, 2, 3, 2, 2, 2, 2, 1],
  // y=7:  水平目地ライン
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
  // y=8:  石ブロック B 行（オフセット: 4px ずらし）
  [2, 2, 3, 1, 1, 3, 2, 2, 2, 2, 3, 1, 1, 3, 2, 2],
  // y=9
  [2, 2, 2, 1, 1, 2, 2, 2, 2, 2, 2, 1, 1, 2, 2, 2],
  // y=10
  [2, 3, 2, 1, 1, 2, 2, 3, 2, 2, 2, 1, 1, 2, 3, 2],
  // y=11
  [2, 2, 2, 1, 1, 2, 2, 2, 2, 3, 2, 1, 1, 2, 2, 2],
  // y=12
  [2, 2, 2, 1, 1, 2, 3, 2, 2, 2, 2, 1, 1, 2, 2, 2],
  // y=13
  [3, 2, 2, 1, 1, 2, 2, 2, 3, 2, 2, 1, 1, 2, 2, 3],
  // y=14
  [2, 2, 3, 1, 1, 2, 2, 2, 2, 2, 3, 1, 1, 3, 2, 2],
  // y=15: 下端の目地ライン
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
];

/**
 * 床タイルスプライト
 *
 * 暗い石畳パターン。ダンジョンの通路や部屋の床に使用する。
 * 目地（モルタル）ラインで区切られた石ブロックが並ぶデザイン。
 */
export const FLOOR_SPRITE: SpriteDefinition = {
  width: 16,
  height: 16,
  pixels: FLOOR_PIXELS,
  palette: FLOOR_PALETTE,
};

// ---------------------------------------------------------------------------
// 壁タイル（レンガパターン）
// ---------------------------------------------------------------------------
// パレット:
//   0 = 透明
//   1 = #1f2937（最も暗い - 目地）
//   2 = #374151（暗い - レンガのベース色）
//   3 = #4b5563（中間 - レンガの明るい面）
//   4 = #6b7280（明るい - ハイライト）
// ---------------------------------------------------------------------------

/** 壁タイルのパレット */
const WALL_PALETTE = ['', '#1f2937', '#374151', '#4b5563', '#6b7280'];

/** 壁タイルのピクセルデータ（16×16） - レンガ模様 */
const WALL_PIXELS: number[][] = [
  // y=0:  目地ライン（上端）
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
  // y=1:  レンガ行 A（7px + 目地 + 7px）
  [4, 3, 3, 2, 2, 2, 3, 1, 4, 3, 3, 2, 2, 2, 3, 1],
  // y=2
  [3, 3, 2, 2, 2, 2, 2, 1, 3, 3, 2, 2, 2, 2, 2, 1],
  // y=3
  [3, 2, 2, 2, 2, 2, 2, 1, 3, 2, 2, 2, 2, 2, 2, 1],
  // y=4:  目地ライン
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
  // y=5:  レンガ行 B（オフセット: 4px ずらし）
  [2, 2, 3, 1, 4, 3, 3, 2, 2, 2, 3, 1, 4, 3, 3, 2],
  // y=6
  [2, 2, 2, 1, 3, 3, 2, 2, 2, 2, 2, 1, 3, 3, 2, 2],
  // y=7
  [2, 2, 2, 1, 3, 2, 2, 2, 2, 2, 2, 1, 3, 2, 2, 2],
  // y=8:  目地ライン
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
  // y=9:  レンガ行 C（行 A と同じパターン）
  [4, 3, 3, 2, 2, 2, 3, 1, 4, 3, 3, 2, 2, 2, 3, 1],
  // y=10
  [3, 3, 2, 2, 2, 2, 2, 1, 3, 3, 2, 2, 2, 2, 2, 1],
  // y=11
  [3, 2, 2, 2, 2, 2, 2, 1, 3, 2, 2, 2, 2, 2, 2, 1],
  // y=12: 目地ライン
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
  // y=13: レンガ行 D（行 B と同じパターン）
  [2, 2, 3, 1, 4, 3, 3, 2, 2, 2, 3, 1, 4, 3, 3, 2],
  // y=14
  [2, 2, 2, 1, 3, 3, 2, 2, 2, 2, 2, 1, 3, 3, 2, 2],
  // y=15
  [2, 2, 2, 1, 3, 2, 2, 2, 2, 2, 2, 1, 3, 2, 2, 2],
];

/**
 * 壁タイルスプライト
 *
 * レンガ模様の壁。ダンジョンの壁面に使用する。
 * 交互にオフセットされたレンガ行で構成され、
 * 左上にハイライト、右下に影を入れることで立体感を表現。
 */
export const WALL_SPRITE: SpriteDefinition = {
  width: 16,
  height: 16,
  pixels: WALL_PIXELS,
  palette: WALL_PALETTE,
};

// ---------------------------------------------------------------------------
// ステージ別パレット
// ---------------------------------------------------------------------------

/** ステージ1: 土の迷宮（茶色系） */
const STAGE1_FLOOR_PALETTE = ['', '#2a1f14', '#3d2e1f', '#4e3d2a'];
const STAGE1_WALL_PALETTE = ['', '#3d2e1f', '#5c4a32', '#7a6445', '#96804e'];

/** ステージ2: 石の迷宮（灰色系 = デフォルト） */
const STAGE2_FLOOR_PALETTE = FLOOR_PALETTE;
const STAGE2_WALL_PALETTE = WALL_PALETTE;

/** ステージ3: 水晶の迷宮（青緑系） */
const STAGE3_FLOOR_PALETTE = ['', '#0a2a2a', '#0f3d3d', '#164d4d'];
const STAGE3_WALL_PALETTE = ['', '#0f3d3d', '#1a5c5c', '#257a7a', '#30998f'];

/** ステージ4: 闇の迷宮（紫系） */
const STAGE4_FLOOR_PALETTE = ['', '#1a0f2e', '#261547', '#331a5c'];
const STAGE4_WALL_PALETTE = ['', '#261547', '#3d2470', '#5c3a99', '#7a50c2'];

/** ステージ5: 深淵（深紅/黒系） */
const STAGE5_FLOOR_PALETTE = ['', '#1a0a0a', '#2e0f0f', '#3d1414'];
const STAGE5_WALL_PALETTE = ['', '#2e0f0f', '#4d1a1a', '#6b2424', '#8a2e2e'];

/** ステージ別パレットマップ */
const STAGE_PALETTES: Record<StageNumber, { floor: string[]; wall: string[] }> = {
  1: { floor: STAGE1_FLOOR_PALETTE, wall: STAGE1_WALL_PALETTE },
  2: { floor: STAGE2_FLOOR_PALETTE, wall: STAGE2_WALL_PALETTE },
  3: { floor: STAGE3_FLOOR_PALETTE, wall: STAGE3_WALL_PALETTE },
  4: { floor: STAGE4_FLOOR_PALETTE, wall: STAGE4_WALL_PALETTE },
  5: { floor: STAGE5_FLOOR_PALETTE, wall: STAGE5_WALL_PALETTE },
};

/**
 * ステージに応じた床スプライトを取得する
 */
export function getStageFloorSprite(stage: StageNumber): SpriteDefinition {
  return {
    ...FLOOR_SPRITE,
    palette: STAGE_PALETTES[stage].floor,
  };
}

/**
 * ステージに応じた壁スプライトを取得する
 */
export function getStageWallSprite(stage: StageNumber): SpriteDefinition {
  return {
    ...WALL_SPRITE,
    palette: STAGE_PALETTES[stage].wall,
  };
}

// ---------------------------------------------------------------------------
// ゴールタイル（下り階段 + 緑の光アニメーション）
// ---------------------------------------------------------------------------
// パレット:
//   0 = 透明
//   1 = #065f46（暗い緑 - 影・輪郭）
//   2 = #10b981（緑 - メインカラー）
//   3 = #34d399（明るい緑 - ハイライト・光）
// ---------------------------------------------------------------------------

/** ゴールタイルのパレット */
const GOAL_PALETTE = ['', '#065f46', '#10b981', '#34d399'];

/**
 * ゴールタイル フレーム1（通常輝度）のピクセルデータ（16×16）
 * 下り階段 + 緑の輝き
 */
const GOAL_FRAME1_PIXELS: number[][] = [
  // y=0
  [0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0],
  // y=1
  [0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0],
  // y=2
  [0, 0, 1, 2, 3, 3, 2, 2, 2, 2, 3, 3, 2, 1, 0, 0],
  // y=3:  階段の段 1
  [0, 1, 2, 3, 3, 2, 2, 2, 2, 2, 2, 3, 3, 2, 1, 0],
  // y=4
  [1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1],
  // y=5:  階段の段 2
  [1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1],
  // y=6
  [1, 2, 1, 2, 3, 2, 2, 2, 2, 2, 2, 3, 2, 1, 2, 1],
  // y=7
  [1, 2, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 1],
  // y=8:  階段の段 3
  [1, 2, 1, 2, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1],
  // y=9
  [1, 2, 1, 2, 1, 2, 3, 2, 2, 3, 2, 1, 2, 1, 2, 1],
  // y=10
  [1, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 1],
  // y=11: 階段の段 4（最深部）
  [1, 2, 1, 2, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 2, 1],
  // y=12
  [1, 2, 1, 2, 1, 2, 1, 2, 2, 1, 2, 1, 2, 1, 2, 1],
  // y=13
  [1, 2, 1, 2, 1, 2, 1, 1, 1, 1, 2, 1, 2, 1, 2, 1],
  // y=14
  [1, 2, 1, 2, 1, 2, 2, 2, 2, 2, 2, 1, 2, 1, 2, 1],
  // y=15
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
];

/**
 * ゴールタイル フレーム2（高輝度 - フラッシュ）のピクセルデータ（16×16）
 * 一部の色をより明るい色に差し替え、点滅効果を演出
 */
const GOAL_FRAME2_PIXELS: number[][] = [
  // y=0
  [0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0],
  // y=1
  [0, 0, 0, 1, 3, 3, 3, 3, 3, 3, 3, 3, 1, 0, 0, 0],
  // y=2
  [0, 0, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 0, 0],
  // y=3
  [0, 1, 3, 3, 3, 3, 2, 2, 2, 2, 3, 3, 3, 3, 1, 0],
  // y=4
  [1, 3, 3, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 1],
  // y=5
  [1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1],
  // y=6
  [1, 3, 1, 3, 3, 3, 2, 2, 2, 2, 3, 3, 3, 1, 3, 1],
  // y=7
  [1, 3, 1, 3, 2, 2, 2, 2, 2, 2, 2, 2, 3, 1, 3, 1],
  // y=8
  [1, 3, 1, 3, 1, 1, 1, 1, 1, 1, 1, 1, 3, 1, 3, 1],
  // y=9
  [1, 3, 1, 3, 1, 3, 3, 3, 3, 3, 3, 1, 3, 1, 3, 1],
  // y=10
  [1, 3, 1, 3, 1, 3, 2, 2, 2, 2, 3, 1, 3, 1, 3, 1],
  // y=11
  [1, 3, 1, 3, 1, 3, 1, 1, 1, 1, 3, 1, 3, 1, 3, 1],
  // y=12
  [1, 3, 1, 3, 1, 3, 1, 3, 3, 1, 3, 1, 3, 1, 3, 1],
  // y=13
  [1, 3, 1, 3, 1, 3, 1, 1, 1, 1, 3, 1, 3, 1, 3, 1],
  // y=14
  [1, 3, 1, 3, 1, 3, 3, 3, 3, 3, 3, 1, 3, 1, 3, 1],
  // y=15
  [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
];

/**
 * ゴールタイルスプライトシート（アニメーション）
 *
 * 下り階段をモチーフにした緑色の輝くタイル。
 * 2フレームで点滅し、プレイヤーにゴール位置を視覚的に伝える。
 * フレーム間隔は 500ms（1秒に2回点滅）。
 */
export const GOAL_SPRITE_SHEET: SpriteSheetDefinition = {
  sprites: [
    {
      width: 16,
      height: 16,
      pixels: GOAL_FRAME1_PIXELS,
      palette: GOAL_PALETTE,
    },
    {
      width: 16,
      height: 16,
      pixels: GOAL_FRAME2_PIXELS,
      palette: GOAL_PALETTE,
    },
  ],
  frameDuration: 500,
};

// ---------------------------------------------------------------------------
// スタートタイル（青く光る円形タイル）
// ---------------------------------------------------------------------------
// パレット:
//   0 = 透明
//   1 = #1e40af（暗い青 - 外縁・影）
//   2 = #3b82f6（青 - メインカラー）
//   3 = #60a5fa（明るい青 - 中心のハイライト）
// ---------------------------------------------------------------------------

/** スタートタイルのパレット */
const START_PALETTE = ['', '#1e40af', '#3b82f6', '#60a5fa'];

/** スタートタイルのピクセルデータ（16×16） - 青く光る円形 */
const START_PIXELS: number[][] = [
  // y=0
  [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
  // y=1
  [0, 0, 0, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 0, 0, 0],
  // y=2
  [0, 0, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 0, 0],
  // y=3
  [0, 1, 1, 2, 2, 2, 2, 3, 3, 2, 2, 2, 2, 1, 1, 0],
  // y=4
  [0, 1, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 1, 0],
  // y=5
  [1, 1, 2, 2, 2, 3, 3, 3, 3, 3, 3, 2, 2, 2, 1, 1],
  // y=6
  [1, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 1],
  // y=7
  [1, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 1],
  // y=8
  [1, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 1],
  // y=9
  [1, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 2, 2, 2, 1],
  // y=10
  [1, 1, 2, 2, 2, 3, 3, 3, 3, 3, 3, 2, 2, 2, 1, 1],
  // y=11
  [0, 1, 2, 2, 2, 2, 3, 3, 3, 3, 2, 2, 2, 2, 1, 0],
  // y=12
  [0, 1, 1, 2, 2, 2, 2, 3, 3, 2, 2, 2, 2, 1, 1, 0],
  // y=13
  [0, 0, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 0, 0],
  // y=14
  [0, 0, 0, 1, 1, 1, 2, 2, 2, 2, 1, 1, 1, 0, 0, 0],
  // y=15
  [0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0],
];

/**
 * スタートタイルスプライト
 *
 * 青く光る円形のタイル。プレイヤーの初期位置を示す。
 * 中心に向かって明るくなるグラデーション効果で、
 * 魔法陣やワープポイントのような雰囲気を演出。
 */
export const START_SPRITE: SpriteDefinition = {
  width: 16,
  height: 16,
  pixels: START_PIXELS,
  palette: START_PALETTE,
};
