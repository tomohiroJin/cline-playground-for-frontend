# IPNE 操作方法・デバッグモード

## 基本操作

### PC操作

| 操作 | キー |
|------|------|
| 移動 | WASD または 矢印キー |
| 攻撃 | スペースキー |
| マップ切替 | M キー |
| ヘルプ表示 | H キー |

### モバイル操作

| 操作 | 方法 |
|------|------|
| 移動 | D-padタップ |
| 攻撃 | D-pad中央の攻撃ボタンタップ |
| マップ切替 | マップアイコンタップ |
| ヘルプ表示 | ヘルプアイコンタップ |

---

## 移動操作詳細

### 連続移動

キーまたはD-padを押し続けると自動的に移動を繰り返す。

| 項目 | 値 |
|------|-----|
| 初回遅延 | 150ms（キーリピート開始までの待機） |
| 移動間隔 | 100ms（秒速10マス） |
| 壁衝突時 | 移動停止 |

### 向きの更新

- 移動不可の場合でも向きは更新される
- 攻撃キー押下中は方向入力で向きのみ変更（移動しない）

---

## 攻撃操作詳細

### 攻撃仕様

| 項目 | 値 |
|------|-----|
| 攻撃範囲 | 前方（現在の向き）attackRangeタイル |
| クールタイム | 500ms × attackSpeed |
| ヒット効果 | 敵を1タイルノックバック |

### 攻撃中の向き変更

スペースキー（または攻撃ボタン）を押しながら方向キーを押すと、移動せずに向きだけを変更できる。

---

## マップ操作詳細

### 表示モード切替

3段階サイクル：小窓 → 全画面 → 非表示 → 小窓

| モード | 説明 |
|--------|------|
| 小窓 | 画面右上に小窓（200x200px） |
| 全画面 | 画面中央に大きく表示（80%） |
| 非表示 | マップを隠す |

---

## ショートカット一覧

### ゲーム中

| キー | 機能 |
|------|------|
| WASD / 矢印 | 移動 |
| スペース | 攻撃 |
| M | マップ表示切替 |
| H | ヘルプ表示切替 |

### メニュー画面

| キー | 機能 |
|------|------|
| Enter / スペース | 決定 |
| 矢印 / WASD | 選択移動 |

---

## デバッグモード

開発時のマップ確認やバグ調査に使用するデバッグ機能。

### 有効化方法

URLパラメータ `debug=1` を追加してアクセス。

```
http://localhost:3000/ipne?debug=1
```

### デバッグショートカット

デバッグモードが有効な場合、以下のショートカットが使用可能。

| キー | 機能 | 説明 |
|------|------|------|
| `Shift+D` | パネル表示切替 | デバッグパネルの表示/非表示を切り替え |
| `Shift+F` | 全マップ表示切替 | 迷路全体をミニマップに表示 |
| `Shift+C` | 座標表示切替 | プレイヤー位置の座標をオーバーレイ表示 |
| `Shift+P` | パス表示切替 | スタート→ゴールの最短経路を表示 |

> Shiftキーとの組み合わせにより、移動キー（WASD）と競合しない

### デバッグパネル

画面左上に表示されるパネルで、以下の情報を確認可能。

| 項目 | 説明 |
|------|------|
| `Player: (x, y)` | プレイヤーの現在位置（タイル座標） |
| `Viewport: (x, y)` | ビューポート左上の位置（タイル座標） |
| `Map: WxH` | マップサイズ（幅×高さ） |
| オプション状態 | 各機能のON/OFF状態（`*`がON） |

### デバッグ機能詳細

#### 全マップ表示（Shift+F）

通常のオートマッピングでは探索したエリアのみ表示されるが、
この機能を有効にすると迷路全体がミニマップに表示される。

**使用シーン:**
- 迷路生成の確認
- ゴール位置の確認
- 迷路の複雑さの評価

#### 座標表示（Shift+C）

プレイヤーキャラクターの上に現在のタイル座標が表示される。

**使用シーン:**
- 位置特定のデバッグ
- 移動処理の確認
- バグレポート時の位置情報取得

#### パス表示（Shift+P）

スタート地点からゴール地点への最短経路をハイライト表示。

**使用シーン:**
- 経路探索アルゴリズムの確認
- 迷路の難易度評価
- 到達不可能なゴールのチェック

---

## 注意事項

### デバッグモードについて

- デバッグモードは開発・テスト目的
- 本番環境では `?debug=1` を付けずにアクセスすること
- デバッグ機能を有効にすると、ゲーム体験が損なわれる場合がある

### 操作の優先度

- タップ中はキー入力を無視（タップ > キーボード）
- 攻撃キー押下中は移動しない（向きのみ変更）
