# IPNE ゲームプレイ仕様

## ゲームフロー

```
TITLE → CLASS_SELECT → PROLOGUE → (TUTORIAL) → GAME → CLEAR
                                                  ↓
                                            (LEVEL_UP) ← 一時停止オーバーレイ
                                                  ↓
                                             GAME_OVER → GAME (リトライ)
                                                  ↓
                                                TITLE
```

### 画面一覧

| 画面 | 説明 |
|------|------|
| TITLE | タイトル画面 |
| CLASS_SELECT | 職業選択画面 |
| PROLOGUE | プロローグ画面（開始直後1回） |
| TUTORIAL | チュートリアル（初回のみ） |
| GAME | ゲーム画面（マップ・HP・能力値表示） |
| LEVEL_UP | レベルアップ選択（オーバーレイ） |
| CLEAR | クリア画面（リザルト・エピローグ） |
| GAME_OVER | ゲームオーバー画面 |

---

## 職業システム

### 職業一覧

| 職業 | 説明 | 特徴 |
|------|------|------|
| **戦士** | ぶつかりながら進むタイプ | 高HP・高攻撃力・回復ボーナスあり |
| **盗賊** | 危険を察知しながら進むタイプ | 高移動速度・罠/特殊壁が薄く見える |

### 職業別初期能力値

| 能力 | 戦士 | 盗賊 | 説明 |
|------|------|------|------|
| HP | 20 | 12 | 最大HP |
| 攻撃力 | 2 | 1 | 1撃のダメージ量 |
| 攻撃距離 | 1 | 1 | 攻撃の届く距離（タイル） |
| 移動速度 | 4 | 6 | 移動速度（タイル/秒） |
| 攻撃速度 | 0.7 | 1.0 | クールダウン倍率（低いほど速い） |
| 回復ボーナス | 1 | 0 | 回復アイテムの追加回復量 |

### 職業による視認性の差

| 対象 | 戦士 | 盗賊 |
|------|------|------|
| 罠（隠れ状態） | 見えない | 薄く見える |
| 特殊壁 | 触れると判明 | 薄く見える |
| 敵 | 見える | 見える |
| アイテム | 見える | 見える |

---

## 戦闘システム

### プレイヤー攻撃

| 項目 | 値 |
|------|-----|
| 入力 | スペースキー / 攻撃ボタンタップ |
| 範囲 | 前方1タイル（現在の向き） |
| ダメージ | attackPower値 |
| クールタイム | 500ms × attackSpeed |
| ヒット効果 | 敵を1タイルノックバック |

### ダメージ仕様

| 項目 | 値 |
|------|-----|
| ダメージ発生 | 敵との接触 |
| ダメージ量 | 敵のdamage値 |
| 無敵時間 | 被ダメージ後1000ms |
| 視覚効果 | プレイヤー点滅（100ms間隔） |

### ノックバック

| 項目 | 値 |
|------|-----|
| 距離 | 1タイル |
| 時間 | 200ms |
| 壁衝突 | その場で停止 |
| 対象 | 攻撃を受けた敵 / ダメージを受けたプレイヤー |

---

## HP・回復設計

### HP仕様

| 項目 | 値 |
|------|-----|
| 自然回復 | なし |
| 回復手段 | アイテムのみ |
| 設計思想 | すぐ死なないが、無視もできない量 |

### 無敵時間

| 項目 | 値 |
|------|-----|
| 被ダメージ後無敵時間 | 1000ms |
| 点滅間隔 | 100ms |
| 視覚効果 | 表示/非表示の切替 |

---

## 自動マッピング仕様

### 表示ルール

**マップは「線のみ」で構成する。壁は表示しない。**

| エリア | 表示 |
|--------|------|
| 未探索 | 非表示（黒/透明） |
| 通過済み通路 | 線で表示（細線） |
| 通過済み部屋 | 線で輪郭表示（塗りつぶしなし） |
| 壁 | **表示しない** |
| 現在位置 | マーカー表示 |
| ゴール位置 | 発見後のみ表示 |

マップは「調査ログ」であり、完全な地図ではない。

### 探索判定

- プレイヤーが通過したタイルを「探索済み」とする
- 探索済みタイルの隣接タイルは「見える」状態に

### 表示モード

| モード | 説明 |
|--------|------|
| 小窓モード | 画面右上に小窓（200x200px） |
| 全画面モード | 画面中央に大きく表示（80%） |
| 非表示 | マップを隠す |

3段階サイクル：小窓 → 全画面 → 非表示 → 小窓

---

## 評価システム

### 評価基準

| 評価 | 条件（クリアタイム） | エピローグ |
|------|---------------------|------------|
| S | 0〜2分 | 迷宮の支配者 |
| A | 2〜3分 | 熟練の生還者 |
| B | 3〜5分 | 堅実な踏破者 |
| C | 5〜8分 | 辛勝の脱出者 |
| D | 8分以上 | 瀕死の帰還者 |

### タイマー動作

| 項目 | 値 |
|------|-----|
| 計測開始 | 操作可能になった瞬間 |
| 計測停止 | ゴール到達 または HP<=0 |
| 一時停止 | レベルアップUI表示中 |
| 表示形式 | mm:ss.ms |

---

## リザルト画面

### クリア時の表示内容

| 項目 | 内容 |
|------|------|
| タイム | mm:ss.ms 形式 |
| 評価 | S/A/B/C/D |
| レベル | 到達レベル |
| 撃破数 | 敵撃破数 |
| 職業 | 戦士/盗賊 |
| ベスト更新 | 新記録時に表示 |
| エピローグ | 評価別テキスト |

ボタン：リトライ / タイトルへ

### ゲームオーバー時の表示内容

| 項目 | 内容 |
|------|------|
| タイム | mm:ss.ms 形式 |
| レベル | 到達レベル |
| 撃破数 | 敵撃破数 |
| 職業 | 戦士/盗賊 |
| テキスト | ゲームオーバー用テキスト |

ボタン：リトライ / タイトルへ

---

## チュートリアル

### チュートリアルステップ

| ステップ | 内容 | 完了条件 |
|---------|------|----------|
| MOVE | 「WASDまたは矢印キーで移動」 | 4回移動 |
| ATTACK | 「スペースキーで攻撃」 | 1回攻撃 |
| MAP | 「Mキーでマップ切替」 | マップ表示切替 |
| TRAP | 「罠は再使用される。盗賊は罠が見える」 | 確認ボタン |
| COMPLETE | チュートリアル完了 | 自動 |

- 初回のみ表示
- スキップ可能

---

## フィードバック

### フィードバック一覧

| イベント | 視覚効果 | 時間 |
|---------|---------|------|
| 被弾 | 画面赤フラッシュ | 100ms |
| 罠発動 | 足元エフェクト | 200ms |
| レベルアップ | 通知ポップ | 500ms |
| アイテム取得 | 小さなポップ | 300ms |
