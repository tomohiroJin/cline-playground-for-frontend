# IPNE 次期MVP仕様書
## MVP4：仕上げ・演出・リプレイ価値（Polish & Loop）

本仕様書は、現状の実装（=MVP3到達・バランス調整済み）を前提に、
**「遊び続けられる完成形に寄せる」ためのMVP4** を定義する。

MVP4は新規システム追加よりも、
**分かりやすさ／気持ちよさ／再挑戦動機／安定運用** を優先する。

---

## 0. 前提（現状の実装差分を反映）

MVP4は以下の“既に実装されている仕様”を前提とする。

- 職業：戦士/盗賊（情報可視性差＋初期能力差）
- 成長：撃破数によるLv1→10、**5択**（攻撃力/距離/速度/攻撃速度/回復量）
- 敵：4種+ボス（レンジド追加、FLEE→SPECIMEN）
- 罠：3種（ダメージ/スロー/テレポート）、**再使用＋クールダウン**
- 特殊壁：破壊/すり抜け/透明（破壊可能壁は攻撃で破壊可能）
- アイテム：回復2種＋全回復/レベルアップ/マップ公開
- UI：職業選択、レベルアップオーバーレイ、ステータス表示、マップ切替
- 80x80の自動生成迷路

（上記は現状タスク・仕様・エンティティガイドに基づく）

---

## 1. MVP4のゴール

以下をすべて満たせばMVP4完了とする。

1. **初見でルールが理解できる**（迷わない）
2. **1プレイ5〜10分で安定**（極端な事故が減る）
3. **リトライ動機が生まれる**（タイム/評価/差分）
4. **演出が最小コストで“気持ちよさ”に寄与**
5. **クラッシュ/ハマり/理不尽が体感上ほぼ無い**

---

## 2. MVP4のスコープ

### 2.1 追加・改善するもの（MVP4でやる）

#### A. リプレイ価値（評価・記録）

- クリアタイム計測
- リザルト（クリア/ゲームオーバー）で以下を表示
  - クリアタイム
  - 撃破数
  - 到達レベル
  - 取得アイテム数（任意）
- ベスト記録（ローカル保存）
  - 職業別ベストタイム
  - シード別（任意・後述）

#### B. エンディング分岐（軽量ナラティブ）

- 既定の「プロローグ1枚＋エンディング1枚」を継続
- クリアタイムで **エピローグ文面のみ** 3段階に分岐
  - S（最短）/A（標準）/B（ぎりぎり）
- ゲームオーバー文面も1種追加

※画像は増やさず、テキスト差分で繰り返し価値を作る

#### C. チュートリアル（1プレイ目だけ/任意OFF可）

- タイトル→職業選択後、ゲーム開始直後に
  - 移動
  - 攻撃
  - マップ切替
  - 「盗賊は罠/特殊壁が薄く見える」
  - 「罠は再使用される」
  を短文で案内

#### D. UX改善（分かりやすさの底上げ）

- 重要フィードバックの追加
  - 被弾：画面フラッシュ/SE（超短）
  - 罠発動：足元エフェクト/SE（超短）
  - レベルアップ：通知→選択UI
  - アイテム取得：小さなポップ
- 表示の整理
  - ステータス表示の“重要順”を固定（HP→Lv→次Lvまで→主要能力）

#### E. バランス・生成の安定化（事故率低減）

- 生成の受け入れ基準（生成リトライ条件）
  - スタート近傍（半径N）にボス・高密度敵・罠が集中しすぎる場合は生成し直す
  - ゴール周辺の空間が狭すぎる場合は生成し直す
- 配置ルールの微調整
  - SPECIMEN は“追いかけて得する”体験を強化（後述）

#### F. 仕様の明文化（運用のため）

- Entity Guide（見分け方）をゲーム内ヘルプに取り込む（簡易版）
- キーバインド/操作説明をメニューに統合

---

### 2.2 やらないこと（MVP4ではやらない）

- 装備/クラフト/スキルツリー
- 新職業
- 新しい敵タイプ追加
- マルチプレイ
- セーブ&ロード（ラン単位の継続）
- 本格的な物語分岐（大量テキスト）
- 高コストなアート大量投入

---

## 3. 追加仕様の詳細

### 3.1 リザルトUI

#### クリア
- 表示：
  - タイム（mm:ss.ms）
  - Lv
  - 撃破数
  - 職業
- ボタン：
  - リトライ
  - タイトルへ

#### ゲームオーバー
- 表示：
  - 到達タイム
  - 到達Lv
  - 撃破数
  - 「原因」（最後に受けたダメージ種別：敵/罠）※任意
- ボタン：
  - リトライ
  - タイトルへ

---

### 3.2 タイム計測

- 計測開始：操作可能になった瞬間
- 計測停止：
  - クリア：ゴール到達
  - ゲームオーバー：HP<=0
- 一時停止：レベルアップUI表示中はタイマー停止

---

### 3.3 ベスト記録（ローカル）

- localStorage に保存
  - bestTimeWarrior
  - bestTimeThief
  - bestTimeOverall
- 保存失敗時は黙って無効化（ゲーム進行を妨げない）

---

### 3.4 “SPECIMEN（標本）”の価値付け（MVP4の重点）

現状課題：「罠を全て避けるだけ」「標本を無視しがち」が起きやすい。

MVP4では**新要素を増やさず**、既存枠で価値付けする。

#### 方針
- SPECIMEN を倒すメリットを明確化

#### 仕様案（いずれか/併用）
- 倒すと **回復小（+3相当）** を確率で落とす（低確率）
- 倒すと **次のレベルアップ必要撃破数を -1**（上限あり）
- 倒すと **一時的にマップ可視範囲が拡大**（数秒）

※おすすめ：最小実装は「回復小ドロップ（低確率）」

---

### 3.5 罠の“利用”を促す調整

現状：再使用＋クールダウンで戦術利用は可能だが、気づきにくい。

MVP4では「気づける」導線を追加。

- テレポート罠：発動時に短いテキスト（例：『転移反応』）
- スロー罠：発動時に敵にも適用（任意・実装コスト次第）
  - もし難しければ：スロー床は敵が踏むと**一瞬足止め**のみ

---

### 3.6 生成の安定化（事故率低減）

- “初手理不尽”排除
  - スタート周辺にチャージ/ボス/罠の密集が発生したら再生成
- “終盤詰み”排除
  - ゴール周辺が狭すぎる/透明壁連続で理不尽→再生成

---

## 4. テスト／検証（MVP4）

### 4.1 受け入れ基準

- [ ] 10回連続プレイで、初手理不尽（即死/不可避連鎖）が発生しない
- [ ] クリアタイムとベストが保存される
- [ ] リザルトで「何をしたら良いか」が分かる
- [ ] 盗賊/戦士で“体験の差”が説明なしでも伝わる
- [ ] 罠の存在と再使用がプレイ中に気づける

### 4.2 計測したい指標（手動でOK）

- クリア率（戦士/盗賊）
- 平均タイム
- ゲームオーバー原因比率（敵/罠）
- レベルアップ選択の偏り
- SPECIMENの撃破率

---

## 5. 実装タスク（MVP4最小）

1. タイマー実装（停止/再開含む）
2. リザルト画面の拡張（タイム/統計表示）
3. localStorage ベスト保存
4. 1回目チュートリアル（ON/OFF）
5. SE/簡易エフェクト（被弾/罠/レベルアップ/取得）
6. 生成の再試行条件追加
7. SPECIMEN価値付け（最小案：低確率回復ドロップ）

---

（次工程：MVP5＝アート差し替え・UI最終デザイン・配信準備）

