# タスク一覧・進捗管理（IPNE MVP1）

## 進捗サマリー

| フェーズ | 状況 | 完了タスク |
|---------|------|-----------|
| フェーズ0: リネーム・テスト準備 | ✅ 完了 | 4/4 |
| フェーズ1: 自動生成迷路コア | ✅ 完了 | 5/5 |
| フェーズ2: 自動マッピング | ✅ 完了 | 4/4 |
| フェーズ3: ゲーム画面統合 | ✅ 完了 | 3/3 |
| フェーズ4: 調整・検証 | ⚠️ 一部完了 | 2/6 |
| **合計** | **82%** | **18/22** |

---

## フェーズ0: リネーム・テスト準備（TDD起点）

- [x] `ipne-mvp0` → `ipne` にリネーム
  - [x] `src/pages/IpneMvp0Page.tsx` → `IpnePage.tsx`
  - [x] `src/features/ipne-mvp0/` → `src/features/ipne/`
  - [x] `src/App.tsx` のルートを `/ipne-mvp0` → `/ipne` に変更
  - [x] GameListのカードリンク先を更新
- [x] `src/features/ipne/` に迷路生成テスト雛形を追加
- [x] 自動マッピングテスト雛形を追加（探索状態/表示切替）
- [x] `npm test` でリネーム後の既存テストが通ることを確認

---

## フェーズ1: 自動生成迷路コア

- [x] `src/features/ipne/types.ts` を拡張（迷路生成用の型追加）
- [x] `src/features/ipne/mazeGenerator.ts` を作成
  - [x] BSP（Binary Space Partitioning）アルゴリズム実装
  - [x] 部屋生成ロジック（5〜10部屋）
  - [x] 通路生成ロジック（部屋間接続）
  - [x] ループ追加ロジック（0〜2箇所）
- [x] `src/features/ipne/pathfinder.ts` を作成
  - [x] BFS による到達可能性検証
  - [x] スタート→ゴール間の最遠距離計算
- [x] スタート/ゴール配置ロジック実装
  - [x] スタート：外周付近の部屋に配置
  - [x] ゴール：最遠地点に配置
- [x] 迷路サイズ調整（1、2分規模：60x60〜80x80）
  > 実装値: 70x70、maxDepth=4（5-16部屋）、corridorWidth=3、loopCount=1

---

## フェーズ2: 自動マッピング

- [x] `src/features/ipne/autoMapping.ts` を作成
  - [x] 探索状態管理（未探索/探索済み/可視）
  - [x] プレイヤー移動時の探索状態更新
- [x] マップ描画ロジック実装
  - [x] 通過済み通路を線で描画（十字線で表現）
  - [x] 通過済み部屋を塗りつぶしで描画（十字線で表現）
  - [x] 現在位置マーカー描画（円形マーカー）
  - [x] ゴール位置描画（発見後のみ、正方形）
- [x] 半透明オーバーレイ描画（不透明度50〜70%）
  > 実装値: 70%（rgba(0, 0, 0, 0.7)）
- [x] マップ表示切替UI実装
  - [x] PC：`M` キーで切替
  - [x] モバイル：アイコンタップで切替（🗺️ボタン）

---

## フェーズ3: ゲーム画面統合

- [x] 既存の `IpnePage.tsx` に自動生成迷路を統合
  > createMap()による自動生成、initExploration()による探索状態管理を統合
- [x] 自動生成迷路の Canvas 描画実装
  - [x] 床・壁・通路の描画（抽象ファンタジー遺跡カラー）
    > 床: #1f2937、壁: #374151、ゴール: #10b981、プレイヤー: #667eea
  - [x] ゴールの視覚的強調
- [x] マップオーバーレイの統合
  - [x] 常時表示モード（右上小窓）
    > 右上200x200px
  - [x] 全画面モード（画面中央）
    > 画面中央80%サイズ、Mキーで切替

---

## フェーズ4: 調整・検証

### 技術調整

- [x] 迷路難易度調整
  - [x] サイズ調整（広すぎ/狭すぎの調整）
    > 70x70に設定（プレイ時間1-2分を想定）
  - [x] ループ数調整（迷い具合の調整）
    > loopCount=1に設定
  - [x] 部屋数調整
    > maxDepth=4で5-16部屋を生成
- [x] `npm test` 実行で全体パスを確認
  > ✅ 37テストスイート、214テスト全てパス

### プレイ体験検証（手動）

> **MVP1の本質：「プレイヤーが自分で把握しようとするか」を検証**

- [ ] プレイ時間計測（目標：1、2分程度）
  > ⚠️ 要手動テスト
- [ ] マップ使用頻度の確認
  - [ ] マップ表示回数ログ機能の実装（任意）
  - [ ] 2〜3回連続プレイしてマップ使用状況を観察
  > ⚠️ 要手動テスト
- [ ] 以下の評価観点をチェック
  - [ ] マップを何回開いたか
  - [ ] ゴールまで直進できたか
  - [ ] 迷って引き返す行動があったか
  - [ ] 一本道に感じたか／迷路に感じたか
  > ⚠️ 要手動テスト

### NG例の確認

- [ ] 迷路が広すぎてダレる → サイズ縮小
- [ ] 一本道すぎて迷わない → ループ追加/構造変更
- [ ] マップを見なくてもクリアできる → 複雑化
> ⚠️ プレイ体験検証後に判断

---

## 依存関係

```
フェーズ0 → フェーズ1 → フェーズ2 → フェーズ3 → フェーズ4
         ↘            ↗
           並行可能
```

- フェーズ0（リネーム・テスト準備）は最初に完了
- フェーズ1（迷路生成）とフェーズ2（マッピング）は一部並行可能
- フェーズ3（統合）はフェーズ1・2の完了後
- フェーズ4（調整・検証）は全フェーズ完了後

---

## 注意事項

- **既存のMVP0コードを直接拡張・改修**（新規ページ追加ではない）
- 迷路生成は「迷うが詰まらない」を優先
- テストファーストで進める
- 評価観点（マップ使用頻度、迷い発生）を常に意識
