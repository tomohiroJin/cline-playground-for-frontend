# タスク一覧・進捗管理（IPNE MVP1）

## 進捗サマリー

| フェーズ | 状況 | 完了タスク |
|---------|------|-----------|
| フェーズ0: リネーム・テスト準備 | 未着手 | 0/4 |
| フェーズ1: 自動生成迷路コア | 未着手 | 0/5 |
| フェーズ2: 自動マッピング | 未着手 | 0/4 |
| フェーズ3: ゲーム画面統合 | 未着手 | 0/3 |
| フェーズ4: 調整・検証 | 未着手 | 0/6 |
| **合計** | **0%** | **0/22** |

---

## フェーズ0: リネーム・テスト準備（TDD起点）

- [ ] `ipne-mvp0` → `ipne` にリネーム
  - [ ] `src/pages/IpneMvp0Page.tsx` → `IpnePage.tsx`
  - [ ] `src/features/ipne-mvp0/` → `src/features/ipne/`
  - [ ] `src/App.tsx` のルートを `/ipne-mvp0` → `/ipne` に変更
  - [ ] GameListのカードリンク先を更新
- [ ] `src/features/ipne/` に迷路生成テスト雛形を追加
- [ ] 自動マッピングテスト雛形を追加（探索状態/表示切替）
- [ ] `npm test` でリネーム後の既存テストが通ることを確認

---

## フェーズ1: 自動生成迷路コア

- [ ] `src/features/ipne/types.ts` を拡張（迷路生成用の型追加）
- [ ] `src/features/ipne/mazeGenerator.ts` を作成
  - [ ] BSP（Binary Space Partitioning）アルゴリズム実装
  - [ ] 部屋生成ロジック（5〜10部屋）
  - [ ] 通路生成ロジック（部屋間接続）
  - [ ] ループ追加ロジック（0〜2箇所）
- [ ] `src/features/ipne/pathfinder.ts` を作成
  - [ ] BFS による到達可能性検証
  - [ ] スタート→ゴール間の最遠距離計算
- [ ] スタート/ゴール配置ロジック実装
  - [ ] スタート：外周付近の部屋に配置
  - [ ] ゴール：最遠地点に配置
- [ ] 迷路サイズ調整（1、2分規模：60x60〜80x80）

---

## フェーズ2: 自動マッピング

- [ ] `src/features/ipne/autoMapping.ts` を作成
  - [ ] 探索状態管理（未探索/探索済み/可視）
  - [ ] プレイヤー移動時の探索状態更新
- [ ] マップ描画ロジック実装
  - [ ] 通過済み通路を線で描画
  - [ ] 通過済み部屋を塗りつぶしで描画
  - [ ] 現在位置マーカー描画
  - [ ] ゴール位置描画（発見後のみ）
- [ ] 半透明オーバーレイ描画（不透明度50〜70%）
- [ ] マップ表示切替UI実装
  - [ ] PC：`M` キーで切替
  - [ ] モバイル：アイコンタップで切替

---

## フェーズ3: ゲーム画面統合

- [ ] 既存の `IpnePage.tsx` に自動生成迷路を統合
- [ ] 自動生成迷路の Canvas 描画実装
  - [ ] 床・壁・通路の描画（抽象ファンタジー遺跡カラー）
  - [ ] ゴールの視覚的強調
- [ ] マップオーバーレイの統合
  - [ ] 常時表示モード（右上小窓）
  - [ ] 全画面モード（画面中央）

---

## フェーズ4: 調整・検証

### 技術調整

- [ ] 迷路難易度調整
  - [ ] サイズ調整（広すぎ/狭すぎの調整）
  - [ ] ループ数調整（迷い具合の調整）
  - [ ] 部屋数調整
- [ ] `npm test` 実行で全体パスを確認

### プレイ体験検証（手動）

> **MVP1の本質：「プレイヤーが自分で把握しようとするか」を検証**

- [ ] プレイ時間計測（目標：1、2分程度）
- [ ] マップ使用頻度の確認
  - [ ] マップ表示回数ログ機能の実装（任意）
  - [ ] 2〜3回連続プレイしてマップ使用状況を観察
- [ ] 以下の評価観点をチェック
  - [ ] マップを何回開いたか
  - [ ] ゴールまで直進できたか
  - [ ] 迷って引き返す行動があったか
  - [ ] 一本道に感じたか／迷路に感じたか

### NG例の確認

- [ ] 迷路が広すぎてダレる → サイズ縮小
- [ ] 一本道すぎて迷わない → ループ追加/構造変更
- [ ] マップを見なくてもクリアできる → 複雑化

---

## 依存関係

```
フェーズ0 → フェーズ1 → フェーズ2 → フェーズ3 → フェーズ4
         ↘            ↗
           並行可能
```

- フェーズ0（リネーム・テスト準備）は最初に完了
- フェーズ1（迷路生成）とフェーズ2（マッピング）は一部並行可能
- フェーズ3（統合）はフェーズ1・2の完了後
- フェーズ4（調整・検証）は全フェーズ完了後

---

## 注意事項

- **既存のMVP0コードを直接拡張・改修**（新規ページ追加ではない）
- 迷路生成は「迷うが詰まらない」を優先
- テストファーストで進める
- 評価観点（マップ使用頻度、迷い発生）を常に意識
