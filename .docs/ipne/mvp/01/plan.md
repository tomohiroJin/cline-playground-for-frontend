# IPNE MVP1 実装計画（計画駆動）

## 概要

MVP0（歩けて脱出できる）の次段階として、
**自動生成迷路＋調査体験** を実装する。
MVP1の目的は「探索・迷い・理解の体験」をプレイヤーに与え、
**ゲームとして成立しているか** を判断することである。

TDDを前提に、**先にテスト → 最小実装 → 確認** を繰り返す。

---

## MVP1の本質

> **MVP1は「迷路生成ができたか」ではない。**
> **プレイヤーが自分で把握しようとするか** を検証するフェーズである。

技術的な実装完了ではなく、以下の体験が生まれているかが成功基準となる：

- マップを見て「今どこにいるか」を確認したくなる
- 「こっちは行ったから、あっちに行こう」と判断する
- ゴールに辿り着いたとき「迷った」という実感がある

---

## 現状把握（MVP0からの継承）

- ページ構成: `src/pages/IpneMvp0Page.tsx`（タイトル→プロローグ→ゲーム→クリア）
- ロジック分離: `src/features/ipne-mvp0/`
- 操作: WASD/矢印キー + モバイル4分割タップ
- 描画: Canvas ベース
- テスト: Jest + React Testing Library

### MVP1での変更方針

- **既存のMVP0コードを拡張・改修**（新規ページ追加ではない）
- リネーム: `ipne-mvp0` → `ipne`（MVP番号を含まない汎用名）
- GameListのカードはそのまま使用（追加不要）
- gitで履歴管理されているため、各MVP段階を別ページとして残す必要はない

---

## MVP1で新たに必要な要素

1. **自動生成迷路アルゴリズム**
   - 部屋＋通路構成
   - 一本道寄り（ループ0〜2）
   - 必ずスタート→ゴール到達可能

2. **スタート／ゴール配置ロジック**
   - スタート：外周付近
   - ゴール：スタートから最遠地点

3. **自動マッピング（調査ログ）**
   - 未探索エリアは非表示
   - 通過した通路・部屋のみ表示
   - 半透明オーバーレイ表示

---

## フェーズ構成

### フェーズ0: リネーム・テスト準備（TDD起点）

- `ipne-mvp0` → `ipne` にリネーム（ページ・ロジック・ルート）
- 迷路生成アルゴリズムのテスト定義
- マッピング機能のテスト定義

### フェーズ1: 自動生成迷路コア

- 迷路生成アルゴリズム実装（部屋＋通路）
- スタート/ゴール配置ロジック実装
- 到達可能性検証ロジック実装
- 1、2分規模の迷路サイズ調整

### フェーズ2: 自動マッピング

- 探索状態管理ロジック実装
- マップ描画ロジック実装（線のみ）
- マップ表示切替UI実装（常時表示 or ボタン）
- 半透明オーバーレイ描画

### フェーズ3: ゲーム画面統合

- 既存の `IpnePage` に自動生成迷路を統合
- マップオーバーレイの統合
- Canvas描画の更新（抽象ファンタジー遺跡準拠）

### フェーズ4: 調整・検証

- 迷路の難易度調整（サイズ・ループ数）
- プレイ時間計測（目標：1、2分程度）
- マップ使用頻度の確認
- `npm test` 実行で全体パスを確認

### フェーズ5: 動作確認FB対応

- ビューポート/カメラシステム実装（プレイヤー周辺のみ表示）
- ミニマップ位置調整（D-padと重ならない）
- 迷路複雑化（maxDepth=5, loopCount=2）
- デバッグモード実装（URLパラメータ `?debug=1`）

### フェーズ6: UI/操作性改善

- ビューポートサイズ調整（15x11タイル、48pxサイズ）
- メイン画面位置調整（D-padとの重なり回避）
- 連続移動機能実装（キー押し続けで自動移動）
- デバッグモードドキュメント作成

### フェーズ6.5: 追加UI調整（フィードバック対応）

- Canvas位置再調整（D-padとの距離を適切に）
- D-pad連続移動対応（タッチ操作でも連続移動可能に）

---

## 重要方針

- **既存のMVP0コードを拡張・改修**（新規ページ追加ではない）
- 変更はMVP1範囲に限定（敵・HP・罠等は入れない）
- 迷路生成は「迷うが詰まらない」を優先
- マップを見る行為が自然に発生する設計を目指す
- **TDD優先**: 先にテスト → 実装 → リファクタ

---

## 完了条件

- [x] `/ipne` が起動し、E2Eでクリアできる
- [x] 自動生成された迷路を毎回異なる構造で探索できる
- [ ] マップを見る行動が自然に発生する（要手動検証）
- [ ] ゴール到達までに迷いが生じる（要手動検証）
- [ ] 1プレイ1、2分程度で完結する（要手動検証）
- [x] テストが追加され `npm test` が通る
  > ✅ 11テストスイート（ipne関連）、89テスト全てパス

---

## MVP1 → MVP2 への判断基準

以下を満たしたら MVP2（敵・HP・戦闘導入）に進む。

- 探索が退屈でない
- マップ機能が意味を持っている
- 次に「敵が欲しい」と自然に思える
