# LABYRINTH OF SHADOWS è©³ç´°ä»•æ§˜æ›¸

## Phase 1: åŸºç›¤æ•´å‚™

### 1.1 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

**èª²é¡Œ:** æ¯ãƒ•ãƒ¬ãƒ¼ãƒ  `setHud()` / `setMapData()` ã‚’å‘¼ã³å‡ºã—ã€ä¸è¦ãª React å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿ

**æ–¹é‡:**
- `useRef` ã§å‰å›ã® HUD/Map å€¤ã‚’ä¿æŒ
- å€¤ã®æµ…ã„æ¯”è¼ƒã§å¤‰åŒ–ã‚’æ¤œçŸ¥ã—ã€å¤‰åŒ–æ™‚ã®ã¿ `setState` ã‚’å‘¼ã¶
- HUD ã¯æ•´æ•°å€¤ãƒ™ãƒ¼ã‚¹ã®ãŸã‚ `===` æ¯”è¼ƒã§ååˆ†

```typescript
// HUD æ›´æ–°ï¼ˆå¤‰åŒ–æ¤œçŸ¥ä»˜ãï¼‰
const prevHudRef = useRef(hud);
const newHud = { keys: g.keys, req: g.reqKeys, ... };
if (JSON.stringify(newHud) !== JSON.stringify(prevHudRef.current)) {
  prevHudRef.current = newHud;
  setHud(newHud);
}
```

### 1.2 Minimap CanvasåŒ–

**èª²é¡Œ:** DOM è¦ç´ ã«ã‚ˆã‚‹ Minimap ã¯æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ã®Reactå†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã§ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒä½ã„

**æ–¹é‡:**
- `minimap-renderer.ts` ã‚’æ–°è¦ä½œæˆ
- Canvas ref ã‚’ Minimap ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ç®¡ç†
- ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã‹ã‚‰ç›´æ¥ Canvas ã«æç”»

**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹:**
```typescript
export const MinimapRenderer = {
  render(ctx: CanvasRenderingContext2D, data: MinimapData): void;
};

interface MinimapData {
  maze: number[][];
  player: Entity;
  exit: Entity;
  items: Item[];
  enemies: Enemy[];
  keys: number;
  reqKeys: number;
  explored: Record<string, boolean>;
  time: number; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
}
```

### 1.3 ãƒãƒ¼ã‚ºæ©Ÿèƒ½

**æ–¹é‡:**
- `GameState` ã« `paused: boolean` ã‚’è¿½åŠ 
- Escape ã‚­ãƒ¼ã§ãƒˆã‚°ãƒ«
- ãƒãƒ¼ã‚ºä¸­ã¯ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—ã®æ›´æ–°ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæç”»ã®ã¿ï¼‰
- ãƒãƒ¼ã‚ºç”»é¢ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’è¡¨ç¤º

### 1.4 README ä¿®æ­£

- æ“ä½œæ–¹æ³•: ã€ŒCtrl: éš ã‚Œã‚‹ã€â†’ã€ŒSpace: éš ã‚Œã‚‹ã€
- Escape: ãƒãƒ¼ã‚º ã‚’è¿½åŠ 

---

## Phase 2: ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤å¼·åŒ–

### 2.1 æ•µAIæ”¹å–„ï¼ˆBFS ãƒ‘ã‚¹ãƒ•ã‚¡ã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼‰

**èª²é¡Œ:** å˜ç´”ãªè§’åº¦è¿½è·¡ã§å£ã«å¼•ã£ã‹ã‹ã‚‹

**æ–¹é‡:**
- æ•µãŒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æ¤œçŸ¥ã—ãŸéš›ã€BFS ã§æœ€çŸ­çµŒè·¯ã‚’è¨ˆç®—
- ãƒ‘ã‚¹ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã€ä¸€å®šé–“éš”ï¼ˆ500msï¼‰ã§å†è¨ˆç®—
- çµŒè·¯ã®æ¬¡ã®ãƒãƒ¼ãƒ‰ã¸å‘ã‹ã£ã¦ç§»å‹•

```typescript
interface Enemy {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ + è¿½åŠ 
  path: { x: number; y: number }[];
  pathTime: number; // æœ€å¾Œã«ãƒ‘ã‚¹è¨ˆç®—ã—ãŸæ™‚é–“
  type: EnemyType;
}

type EnemyType = 'wanderer' | 'chaser' | 'teleporter';
```

**BFS å®Ÿè£…:**
```typescript
function bfsPath(maze: number[][], sx: number, sy: number, tx: number, ty: number): {x:number,y:number}[]
```

### 2.2 ã‚¢ã‚¤ãƒ†ãƒ ç¨®é¡è¿½åŠ 

| ã‚¢ã‚¤ãƒ†ãƒ  | çµµæ–‡å­— | åŠ¹æœ | å‡ºç¾æ•° |
|---------|--------|------|--------|
| å›å¾©è–¬ | ğŸ’Š | ãƒ©ã‚¤ãƒ•+1ï¼ˆæœ€å¤§å€¤ã¾ã§ï¼‰ | é›£æ˜“åº¦ã«å¿œã˜ã¦1-2å€‹ |
| åŠ é€Ÿ | âš¡ | 10ç§’é–“ç§»å‹•é€Ÿåº¦1.3å€ | é›£æ˜“åº¦ã«å¿œã˜ã¦1å€‹ |
| åœ°å›³ | ğŸ—ºï¸ | å‘¨å›²5ãƒã‚¹ç¯„å›²ã‚’æ¢ç´¢æ¸ˆã¿ã« | é›£æ˜“åº¦ã«å¿œã˜ã¦1å€‹ |

**å‹å®šç¾©å¤‰æ›´:**
```typescript
type EntityType = 'key' | 'trap' | 'exit' | 'exitLocked' | 'enemy'
  | 'heal' | 'speed' | 'map';
```

**GameState è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:**
```typescript
interface GameState {
  // æ—¢å­˜ + è¿½åŠ 
  speedBoost: number; // åŠ é€Ÿæ®‹ã‚Šæ™‚é–“(ms)
}
```

### 2.3 æ•µç¨®é¡è¿½åŠ 

| æ•µã‚¿ã‚¤ãƒ— | çµµæ–‡å­— | è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³ |
|---------|--------|------------|
| å¾˜å¾Šå‹ | ğŸ‘» | ãƒ©ãƒ³ãƒ€ãƒ ã«å·¡å›ã€‚ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¿‘ãã§ã‚‚è¿½è·¡ã—ãªã„ |
| è¿½è·¡å‹ | ğŸ‘¹ | æ—¢å­˜ã®å¼·åŒ–ç‰ˆã€‚BFSè¿½è·¡ã€è¦–é‡å†…ã§åŠ é€Ÿ |
| ãƒ†ãƒ¬ãƒãƒ¼ãƒˆå‹ | ğŸŒ€ | ä¸€å®šé–“éš”ã§ãƒ©ãƒ³ãƒ€ãƒ ä½ç½®ã«ãƒ†ãƒ¬ãƒãƒ¼ãƒˆã€‚çŸ­è·é›¢è¿½è·¡ |

---

## Phase 3: è¦–è¦šãƒ»è´è¦šæ¼”å‡ºå¼·åŒ–

### 3.1 å£ãƒ†ã‚¯ã‚¹ãƒãƒ£æ”¹å–„

**æ–¹é‡:** ãƒ¬ãƒ³ã‚¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«ç”Ÿæˆ

```typescript
// ãƒ¬ãƒ³ã‚¬ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è‰²ã‚’è¨ˆç®—
function getBrickColor(hitX: number, hitY: number, shade: number): string
```

### 3.2 ãƒˆãƒ¼ãƒç…§æ˜åŠ¹æœ

- ãƒ©ãƒ³ãƒ€ãƒ ãªæºã‚‰ãã‚’ç…§æ˜ã«è¿½åŠ 
- `Math.sin(time * frequency) * amplitude` ã§è‡ªç„¶ãªæºã‚‰ã

### 3.3 BGMãƒ»ç’°å¢ƒéŸ³

**æ–¹é‡:** Web Audio API ã§ãƒ—ãƒ­ã‚·ãƒ¼ã‚¸ãƒ£ãƒ«ã‚¢ãƒ³ãƒ“ã‚¨ãƒ³ãƒˆ

```typescript
export const AudioService = {
  // æ—¢å­˜
  play(type: SoundName, vol?: number): void;
  // æ–°è¦
  startBGM(): void;
  stopBGM(): void;
  updateBGM(danger: number): void;
};
```

- ä½å‘¨æ³¢ãƒ‰ãƒ­ãƒ¼ãƒ³ï¼ˆãƒ™ãƒ¼ã‚¹ï¼‰
- ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã§å‘¨æ³¢æ•°/éŸ³é‡ã‚’å‹•çš„ã«å¤‰æ›´
- æ•µãŒè¿‘ã¥ãã¨ä¸å”å’ŒéŸ³ãŒå¢—ã™

### 3.4 ãƒã‚¹ãƒˆãƒ—ãƒ­ã‚»ã‚¹åŠ¹æœ

- **ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³:** æ°´å¹³æ–¹å‘ã®è–„ã„ç·šã§ CRT é¢¨
- **ãƒ“ãƒãƒƒãƒˆ:** ç”»é¢ç«¯ã‚’æš—ãã™ã‚‹åŠ¹æœï¼ˆéš ã‚ŒçŠ¶æ…‹ã®ãƒ“ãƒãƒƒãƒˆã¨ã¯åˆ¥ã«å¸¸æ™‚é©ç”¨ï¼‰

---

## Phase 4: è¿½åŠ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ + ä»•ä¸Šã’

### 4.1 ãƒãƒƒãƒ—ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆPrimæ³•ï¼‰

```typescript
export const MazeService = {
  create(size: number): number[][];      // æ—¢å­˜ï¼ˆå†å¸°å½«åˆ»ï¼‰
  createPrim(size: number): number[][];  // æ–°è¦ï¼ˆPrimæ³•ï¼‰
};
```

- é›£æ˜“åº¦ HARD ã§ãƒ©ãƒ³ãƒ€ãƒ ã« Prim æ³•ã‚’ä½¿ç”¨

### 4.2 3DéŸ³éŸ¿

```typescript
// StereoPannerNode ã§å·¦å³å®šä½
function playSpatial(type: SoundName, vol: number, pan: number): void
```

- æ•µã®ä½ç½®ã‹ã‚‰ãƒ‘ãƒ³å€¤ã‚’è¨ˆç®—

### 4.3 ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å¼·åŒ–

- intro ãƒ†ã‚­ã‚¹ãƒˆã®æ¼”å‡ºæ”¹å–„
- å„é›£æ˜“åº¦ã«å›ºæœ‰ã®ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ

### 4.4 ãƒ†ã‚¹ãƒˆæ‹¡å……

- æ–°æ©Ÿèƒ½ï¼ˆBFSã€æ–°ã‚¢ã‚¤ãƒ†ãƒ ã€æ–°æ•µã€Primæ³•ï¼‰ã®ãƒ†ã‚¹ãƒˆ
- ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç›®æ¨™
