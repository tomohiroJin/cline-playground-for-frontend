# Game Platform UI/UX 改善計画

## 1. 背景と目的

### 1.1 背景

Game Platform は React 19 + TypeScript + styled-components で構築された、13種類の無料ブラウザゲームをホストするプラットフォームである。現在、以下の課題がある。

| # | 課題 | 影響度 |
|---|------|--------|
| 1 | サイト説明ページが存在しない（サイトの目的・免責事項が不明） | 高 |
| 2 | 法的ページが未整備（プライバシーポリシー、利用規約、お問い合わせ） | 高 |
| 3 | 姉妹サイト（gallery.niku9.click）への導線がない | 中 |
| 4 | favicon / PWA アイコンが未設定（manifest.json の icons が空配列） | 中 |
| 5 | 右上の設定画面（SettingsPanel）が各ゲームと連携しておらず機能していない | 高 |
| 6 | ゲームから戻ったときに音声が鳴りっぱなしになる問題 | 高 |
| 7 | コピーライト表記が古い（© 2025） | 低 |
| 8 | 見た目の改善余地がある | 中 |
| 9 | ゲームとプラットフォームの境界管理に改善余地がある | 中 |

### 1.2 目的

上記課題を解決し、プラットフォームとしての完成度・信頼性を高める。

### 1.3 スコープ外

- 各ゲーム内部のロジック変更
- ゲーム個別の音声設定 UI の統一（プラットフォーム側からの強制停止のみ対応）
- ユーザー認証・アカウント機能

---

## 2. 技術スタック（現状）

| カテゴリ | 技術 | バージョン |
|---------|------|-----------|
| フレームワーク | React | 19.0.0 |
| ルーティング | React Router DOM | 7.3.0 |
| スタイリング | styled-components | 6.1.16 |
| 状態管理 | Jotai | 2.12.2 |
| 音声 | Web Audio API / Tone.js | - / 15.1.22 |
| バンドラ | Webpack | 5.98.0 |
| テスト | Vitest / Jest | 4.0.18 / 30.2.0 |
| 言語 | TypeScript | 最新 |

---

## 3. 現状分析

### 3.1 ルーティング構成

現在14ルート（ホーム + 13ゲーム）が定義されている。すべてのゲームルートは `GamePageWrapper` でラップされ、初回アクセス時に注意書きモーダルを表示する。

`useFullScreenRoute` フックにより `pathname !== '/'` でフルスクリーン判定されるため、新規静的ページを追加するとヘッダー/フッターが非表示になってしまう。

### 3.2 SettingsPanel の問題

SettingsPanel は `masterVolume`, `sfxVolume`, `bgmVolume`, `controls`, `showFps`, `reducedMotion` の設定を localStorage（キー: `game-platform-settings`）に保存するが、各ゲームの音声モジュールは独自の localStorage キーと設定形式を使用しているため、SettingsPanel の値を読み取るゲームが存在しない。

### 3.3 音声管理の状況

9つのゲームが Web Audio API を独自に実装している。各ゲームが独立した AudioContext を生成・管理しており、ゲームページからの離脱時に AudioContext が close/suspend されない場合、音声が再生され続ける。

### 3.4 フッターの状況

コピーライト（`© 2025 niku9.click`）のみ。サイト内リンク、法的ページリンク、姉妹サイトリンクが存在しない。

### 3.5 アイコンの状況

- `public/index.html` に favicon のリンクタグなし
- `public/manifest.json` の `icons` 配列が空
- apple-touch-icon 未設定

---

## 4. 実装フェーズ

依存関係を考慮し、以下の順序で実装する。

### フェーズ 1: 基盤変更（前提条件の整備）

新規静的ページ追加の前提として、ルーティング判定の変更と不要機能の削除を行う。

| 項目 | 内容 |
|------|------|
| 1-1 | `useFullScreenRoute` のホワイトリスト方式への変更 |
| 1-2 | SettingsPanel と settings-storage の削除 |
| 1-3 | App.tsx から SettingsPanel 関連コードの削除 |
| 1-4 | コピーライト更新（`© 2026 niku9.click All Rights Reserved.`） |

### フェーズ 2: ゲームからの音声停止機能

ゲームページ離脱時に全音声を安全に停止する仕組みを構築する。

| 項目 | 内容 |
|------|------|
| 2-1 | AudioContext 追跡ユーティリティの作成（`audio-cleanup.ts`） |
| 2-2 | エントリーポイント（`index.tsx`）でのトラッカー初期化 |
| 2-3 | GamePageWrapper のアンマウント時に全音声停止 |

### フェーズ 3: 新規ページ作成

法的ページとサイト説明ページを作成する。gallery.niku9.click の構成を参考に、ゲームプラットフォーム向けにカスタマイズする。

| 項目 | 内容 |
|------|------|
| 3-1 | 静的ページ共通レイアウト（StaticPageLayout） |
| 3-2 | About ページ（サイト概要・特徴・免責事項） |
| 3-3 | プライバシーポリシーページ（全7条） |
| 3-4 | 利用規約ページ（全7条） |
| 3-5 | お問い合わせページ（スパム防止付き） |
| 3-6 | ルーティングとタイトル設定の追加 |
| 3-7 | フッターへの簡易ナビゲーション追加（新規ページへの導線） |

### フェーズ 4: ナビゲーション改善

フッターを拡充し、サイト内リンクと姉妹サイトへの導線を追加する。

| 項目 | 内容 |
|------|------|
| 4-1 | フッターの3段構成への拡張 |

### フェーズ 5: 見た目の改善

CSS アニメーションを中心に、プラットフォームの視覚的な魅力を強化する。

| 項目 | 内容 |
|------|------|
| 5-1 | ヒーローセクションの強化（パーティクル、グロウエフェクト） |
| 5-2 | ゲームカードのホバーエフェクト改善 |
| 5-3 | スクロールアニメーション（useScrollReveal） |
| 5-4 | フッターのデザイン改善（Glassmorphism 適用） |

### フェーズ 6: アイコン設定

ユーザーが AI で生成したアイコンを設定するための準備を行う。

| 項目 | 内容 |
|------|------|
| 6-1 | アイコンデザイン案の提示 |
| 6-2 | `index.html` への favicon リンクタグ追加 |
| 6-3 | `manifest.json` の icons 配列設定 |

### フェーズ 7: ゲームとプラットフォームの境界整理

GamePageWrapper の責務を明確化し、プラットフォームとゲームの境界を強化する。

| 項目 | 内容 |
|------|------|
| 7-1 | GamePageWrapper にゲーム固有の ErrorBoundary ラップを追加 |
| 7-2 | sitemap.xml への新ページ URL 追加 |

---

## 5. フェーズ間の依存関係

```
フェーズ 1（基盤変更）
  └─→ フェーズ 2（音声停止）
  └─→ フェーズ 3（新規ページ）
        └─→ フェーズ 4（ナビゲーション）
  └─→ フェーズ 5（見た目改善）
  └─→ フェーズ 6（アイコン）
フェーズ 2 + フェーズ 7 は並行可能
```

- フェーズ 1 は全フェーズの前提（特にフルスクリーン判定の変更）
- フェーズ 3 はフェーズ 4 の前提（フッターリンクの遷移先が必要）
- フェーズ 2, 5, 6, 7 は相互に独立

---

## 6. ファイル変更サマリ

### 変更対象ファイル

| ファイル | 変更フェーズ | 変更内容 |
|---------|-------------|---------|
| `src/App.tsx` | 1, 3, 4 | SettingsPanel 削除、ルート追加、フッター拡充、コピーライト更新 |
| `src/hooks/useFullScreenRoute.ts` | 1 | ホワイトリスト方式に変更 |
| `src/hooks/useDocumentTitle.ts` | 3 | 静的ページのタイトル追加 |
| `src/components/organisms/GamePageWrapper.tsx` | 2, 7 | 音声停止ロジック追加、ErrorBoundary ラップ |
| `src/index.tsx` | 2 | AudioContext トラッカー初期化 |
| `src/pages/GameListPage.tsx` | 5 | スクロールアニメーション適用 |
| `src/pages/GameListPage.styles.ts` | 5 | ヒーロー強化、カードエフェクト改善 |
| `public/index.html` | 6 | favicon リンク追加 |
| `public/manifest.json` | 6 | icons 配列更新 |
| `public/sitemap.xml` | 7 | 新ページ URL 追加 |

### 削除対象ファイル

| ファイル | 理由 |
|---------|------|
| `src/components/organisms/SettingsPanel.tsx` | 各ゲームと連携しておらず機能していない |
| `src/utils/settings-storage.ts` | SettingsPanel からのみ参照 |

### 新規作成ファイル

| ファイル | フェーズ | 内容 |
|---------|---------|------|
| `src/utils/audio-cleanup.ts` | 2 | AudioContext 追跡・全音声停止ユーティリティ |
| `src/components/templates/StaticPageLayout.tsx` | 3 | 静的ページ共通レイアウト |
| `src/pages/AboutPage.tsx` | 3 | サイト概要ページ |
| `src/pages/PrivacyPolicyPage.tsx` | 3 | プライバシーポリシーページ |
| `src/pages/TermsPage.tsx` | 3 | 利用規約ページ |
| `src/pages/ContactPage.tsx` | 3 | お問い合わせページ |
| `src/hooks/useScrollReveal.ts` | 5 | スクロールアニメーションフック |

### テスト追加対象

| ファイル | 内容 |
|---------|------|
| `src/hooks/useFullScreenRoute.test.tsx` | 静的ページルートのテストケース追加 |
| `src/hooks/useDocumentTitle.test.tsx` | 静的ページタイトルのテストケース追加 |
| `src/utils/audio-cleanup.test.ts` | 音声停止ユーティリティのテスト |

---

## 7. リスクと対策

| リスク | 影響 | 対策 |
|--------|------|------|
| AudioContext のプロキシが一部ブラウザで動作しない | 音声停止が機能しない | Proxy 非対応環境ではフォールバック（手動 close）を用意 |
| SettingsPanel 削除で既存ユーザーの期待を裏切る | UX への不満 | 元々機能していないため影響は軽微 |
| 新規ページ追加で既存ゲームルートに影響 | ゲームが壊れる | ホワイトリスト方式により既存ルートは変更不要 |
| アイコン AI 生成の品質 | ブランドイメージ | 複数案を提示し、ユーザーが選定 |

---

## 8. 検証方法

### 自動テスト

- `npm run build` でビルドエラーがないこと
- 既存テスト + 新規テストが全て通ること

### 手動検証

- 各ルートの表示確認（ヘッダー/フッターの表示/非表示）
- 音声付きゲームの離脱時に音が停止すること
- 再度ゲームに入った際に音声が正常に再生されること
- 全リンクの動作確認
- モバイル表示の崩れがないこと

---

## 9. スケジュール目安

| フェーズ | 見積もり |
|---------|---------|
| フェーズ 1（基盤変更） | 小 |
| フェーズ 2（音声停止） | 中 |
| フェーズ 3（新規ページ） | 中 |
| フェーズ 4（ナビゲーション） | 小 |
| フェーズ 5（見た目改善） | 中 |
| フェーズ 6（アイコン） | 小（AI 生成待ち含む） |
| フェーズ 7（境界整理） | 小 |
