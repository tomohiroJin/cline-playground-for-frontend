# RISK LCD ãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ— â€” ä»•æ§˜æ›¸

## 1. ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸æ©Ÿèƒ½ï¼ˆDaily Cartridgeï¼‰

### 1.1 ã‚·ãƒ¼ãƒ‰ä»˜ãä¹±æ•°ç”Ÿæˆå™¨

#### 1.1.1 `SeededRand` ã‚¯ãƒ©ã‚¹

```typescript
/**
 * mulberry32 ãƒ™ãƒ¼ã‚¹ã®ã‚·ãƒ¼ãƒ‰ä»˜ãæ“¬ä¼¼ä¹±æ•°ç”Ÿæˆå™¨ã€‚
 * æ—¢å­˜ Rand ã¨åŒä¸€ API ã‚’æŒã¡ã€ã‚·ãƒ¼ãƒ‰å€¤ã‹ã‚‰æ±ºå®šè«–çš„ãªä¹±æ•°åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã€‚
 */
class SeededRand {
  private state: number;

  constructor(seed: number);

  /** 0ä»¥ä¸Šnæœªæº€ã®ãƒ©ãƒ³ãƒ€ãƒ æ•´æ•° */
  int(n: number): number;

  /** é…åˆ—ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1è¦ç´ ã‚’é¸æŠ */
  pick<T>(a: readonly T[]): T;

  /** ç¢ºç‡pã§trueã‚’è¿”ã™ */
  chance(p: number): boolean;

  /** é…åˆ—ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ãŸæ–°ã—ã„é…åˆ—ã‚’è¿”ã™ */
  shuffle<T>(a: readonly T[]): T[];

  /** 0ã€œ1 ã®æµ®å‹•å°æ•°ç‚¹ä¹±æ•°ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰ */
  private next(): number;
}
```

#### 1.1.2 mulberry32 ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

```typescript
// mulberry32: 32bit stateã€é«˜é€Ÿãƒ»é«˜å“è³ªãª PRNG
private next(): number {
  let t = (this.state += 0x6d2b79f5);
  t = Math.imul(t ^ (t >>> 15), t | 1);
  t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
  return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
}
```

#### 1.1.3 æ—¥æ¬¡IDãƒ»ã‚·ãƒ¼ãƒ‰å¤‰æ›

```typescript
/** ç¾åœ¨æ—¥ä»˜ã‹ã‚‰æ—¥æ¬¡IDã‚’ç”Ÿæˆ */
function getDailyId(): string;
// æˆ»ã‚Šå€¤ä¾‹: "2026-02-17"

/** æ—¥æ¬¡IDã‹ã‚‰æ•°å€¤ã‚·ãƒ¼ãƒ‰ã‚’ç”Ÿæˆï¼ˆFNV-1a ãƒãƒƒã‚·ãƒ¥ï¼‰ */
function dateToSeed(dateStr: string): number;
// "2026-02-17" â†’ å›ºå®šã®32bitæ•´æ•°
```

**FNV-1a ãƒãƒƒã‚·ãƒ¥**:
```typescript
function dateToSeed(dateStr: string): number {
  let hash = 0x811c9dc5; // FNV offset basis
  for (let i = 0; i < dateStr.length; i++) {
    hash ^= dateStr.charCodeAt(i);
    hash = Math.imul(hash, 0x01000193); // FNV prime
  }
  return hash >>> 0; // ç¬¦å·ãªã—32bit
}
```

### 1.2 ãƒ‡ã‚¤ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ç®¡ç†

#### 1.2.1 å‹å®šç¾©

```typescript
/** ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã®ãƒ—ãƒ¬ã‚¤è¨˜éŒ² */
interface DailyData {
  /** æ—¥æ¬¡IDï¼ˆYYYY-MM-DDï¼‰ */
  date: string;
  /** ãƒ—ãƒ¬ã‚¤æ¸ˆã¿ã‹ */
  played: boolean;
  /** ãƒ‡ã‚¤ãƒªãƒ¼ã®ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢ */
  bestScore: number;
  /** åˆå›ãƒ—ãƒ¬ã‚¤å ±é…¬ã‚’å—é ˜æ¸ˆã¿ã‹ */
  firstPlayRewarded: boolean;
}
```

#### 1.2.2 SaveData æ‹¡å¼µ

```typescript
interface SaveData {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...
  /** ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ€æ–°1æ—¥åˆ†ã®ã¿ï¼‰ */
  daily?: DailyData;
}
```

#### 1.2.3 useStore æ‹¡å¼µãƒ¡ã‚½ãƒƒãƒ‰

| ãƒ¡ã‚½ãƒƒãƒ‰ | å¼•æ•° | æˆ»ã‚Šå€¤ | èª¬æ˜ |
|---------|------|--------|------|
| `getDailyData()` | ãªã— | `DailyData \| null` | ä»Šæ—¥ã®ãƒ‡ã‚¤ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã€‚æ—¥ä»˜ãŒç•°ãªã‚Œã°null |
| `isDailyPlayed()` | ãªã— | `boolean` | ä»Šæ—¥ã®ãƒ‡ã‚¤ãƒªãƒ¼ã‚’ãƒ—ãƒ¬ã‚¤æ¸ˆã¿ã‹ |
| `recordDailyPlay(score)` | `number` | `number` | ã‚¹ã‚³ã‚¢ã‚’è¨˜éŒ²ã—ã€ç²å¾—PTï¼ˆå ±é…¬ï¼‰ã‚’è¿”ã™ |

#### 1.2.4 ãƒ‡ã‚¤ãƒªãƒ¼å ±é…¬ãƒ­ã‚¸ãƒƒã‚¯

```
å ±é…¬ = 0

if (åˆå›ãƒ—ãƒ¬ã‚¤):
  å ±é…¬ += 50  // å›ºå®šãƒœãƒ¼ãƒŠã‚¹
  firstPlayRewarded = true

if (è‡ªå·±ãƒ™ã‚¹ãƒˆæ›´æ–°):
  å·®åˆ† = score - bestScore
  å ±é…¬ += floor(å·®åˆ† * 0.1)  // å·®åˆ†ã®10%
  bestScore = score

played = true
pts += å ±é…¬
```

### 1.3 RNG æ³¨å…¥è¨­è¨ˆ

#### 1.3.0 è¨­è¨ˆæ¦‚è¦

æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã§ã¯ `Rand`ï¼ˆ`utils/random.ts`ï¼‰ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã« `Math.random()` ã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€`wPick`ï¼ˆ`utils/game-logic.ts`ï¼‰ã‚‚ `Math.random()` ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã€‚ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§ã¯å…¨æŠ½é¸ã‚’ã‚·ãƒ¼ãƒ‰åŒ–ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®æ³¨å…¥è¨­è¨ˆã‚’æ¡ç”¨ã™ã‚‹ã€‚

**æ–¹é‡**: `PhaseContext` ã« RNG ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å‚ç…§ã‚’è¿½åŠ 

```typescript
// hooks/phases/types.ts ã«è¿½åŠ 
interface RngApi {
  int(n: number): number;
  pick<T>(a: readonly T[]): T;
  chance(p: number): boolean;
  shuffle<T>(a: readonly T[]): T[];
  /** wPick ç”¨ã® 0ã€œ1 ä¹±æ•° */
  random(): number;
}

interface PhaseContext {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...
  rng: MutableRefObject<RngApi>;
}
```

**é€šå¸¸ãƒ¢ãƒ¼ãƒ‰**: æ—¢å­˜ `Rand` + `Math.random()` ã‚’ãƒ©ãƒƒãƒ—ã—ãŸ `RngApi` äº’æ›ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
**ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰**: `SeededRand` ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ `RngApi` ã¨ã—ã¦è¨­å®š

**å¤‰æ›´å¯¾è±¡ã® `Rand` / `Math.random()` å‘¼ã³å‡ºã—**:

| ãƒ•ã‚¡ã‚¤ãƒ« | ç®‡æ‰€ | ç¾çŠ¶ | å¤‰æ›´å¾Œ |
|---------|------|------|--------|
| `useRunningPhase.ts` | `pickObs` | `Rand.chance()` | `ctx.rng.current.chance()` |
| `useRunningPhase.ts` | `nextCycle` | `Rand.chance()`, `Rand.pick()` | `ctx.rng.current.chance()`, `ctx.rng.current.pick()` |
| `useRunningPhase.ts` | `announce` | `Rand.shuffle()`, `Rand.chance()`, `Rand.pick()` | `ctx.rng.current.*()` |
| `useRunningPhase.ts` | `startGame` | `Rand.shuffle()`, `Rand.pick()` | `ctx.rng.current.*()` |
| `usePerkPhase.ts` | `showPerks` | `Rand.shuffle()` Ã— 2 | `ctx.rng.current.shuffle()` Ã— 2 |
| `game-logic.ts` | `wPick` | `Math.random()` | å¼•æ•° `rng?: () => number` ã‚’è¿½åŠ  |

### 1.4 ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰UI

#### 1.4.1 ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤‰æ›´

æ—¢å­˜ãƒ¡ãƒ‹ãƒ¥ãƒ¼:
```
GAME START / PLAY STYLE / UNLOCK / HELP
```

å¤‰æ›´å¾Œ:
```
GAME START / DAILY / PLAY STYLE / UNLOCK / HELP
```

- `MENUS` é…åˆ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ 1 ã« `'DAILY'` ã‚’æŒ¿å…¥
- æ—¢å­˜ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å‡¦ç†ã‚’æ›´æ–°

#### 1.4.2 DailyScreen ç”»é¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜… DAILY CARTRIDGE â˜…     â”‚
â”‚  2026-02-17              â”‚
â”‚                          â”‚
â”‚  TODAY'S MODIFIER:       â”‚
â”‚  â–¶ RUSH HOUR             â”‚
â”‚    é€Ÿåº¦+20%              â”‚
â”‚                          â”‚
â”‚  [PLAYED: ---]           â”‚  â† æœªãƒ—ãƒ¬ã‚¤æ™‚
â”‚  [BEST: 1234]            â”‚  â† ãƒ—ãƒ¬ã‚¤æ¸ˆã¿æ™‚
â”‚                          â”‚
â”‚  â–¶ START DAILY           â”‚
â”‚  â— BACK                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- `ScreenId: 'D'` ã‚’æ–°è¦è¿½åŠ 
- ACT ãƒœã‚¿ãƒ³ã§ã€ŒSTART DAILYã€å®Ÿè¡Œ
- BACK/LEFT ã§ã‚¿ã‚¤ãƒˆãƒ«ã«æˆ»ã‚‹

#### 1.4.3 ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã®ã‚²ãƒ¼ãƒ ãƒ•ãƒ­ãƒ¼

1. `DailyScreen` ã§ã€ŒSTART DAILYã€é¸æŠ
2. `startGame(daily: true)` ã‚’å‘¼ã³å‡ºã—
3. `SeededRand(dateToSeed(getDailyId()))` ã§ã‚·ãƒ¼ãƒ‰ä»˜ãä¹±æ•°ã‚’åˆæœŸåŒ–
4. ã‚·ãƒ¼ãƒ‰ä»˜ãä¹±æ•°ã§ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ãƒ»éšœå®³é…ç½®ãƒ»ãƒ‘ãƒ¼ã‚¯å€™è£œã‚’æ±ºå®š
5. ã‚¹ãƒ†ãƒ¼ã‚¸é€²è¡Œãƒ»ãƒ‘ãƒ¼ã‚¯é¸æŠã¯é€šå¸¸é€šã‚Šï¼ˆãŸã ã—æŠ½é¸çµæœãŒã‚·ãƒ¼ãƒ‰ã§å›ºå®šï¼‰
6. ãƒªã‚¶ãƒ«ãƒˆæ™‚ã«ãƒ‡ã‚¤ãƒªãƒ¼å ±é…¬ã‚’è¨ˆç®—ãƒ»ä»˜ä¸

---

## 2. ãƒªã‚¶ãƒ«ãƒˆå…±æœ‰ï¼ˆShare Code + ã‚·ã‚§ã‚¢ã‚«ãƒ¼ãƒ‰ï¼‰

### 2.1 å…±æœ‰URLä»•æ§˜

#### 2.1.1 URLãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```
{origin}{pathname}?rlcd=1&daily=2026-02-17&score=3456&build=s:HR_p:Gk.Ss&ghost=...
```

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | å¿…é ˆ | èª¬æ˜ |
|-----------|-----|------|------|
| `rlcd` | `"1"` | Yes | RISK LCD å…±æœ‰URLã®è­˜åˆ¥å­ |
| `daily` | `string` | No | æ—¥æ¬¡IDï¼ˆãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ï¼‰ |
| `score` | `number` | Yes | æœ€çµ‚ã‚¹ã‚³ã‚¢ |
| `build` | `string` | Yes | ãƒ“ãƒ«ãƒ‰è¦ç´„ã‚³ãƒ¼ãƒ‰ |
| `ghost` | `string` | No | ã‚´ãƒ¼ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆSprint 3ï¼‰ |

#### 2.1.2 ãƒ“ãƒ«ãƒ‰è¦ç´„ã‚³ãƒ¼ãƒ‰ï¼ˆbuildï¼‰

**å½¢å¼**: `s:{styleIds}_p:{perkIds}`

- `styleIds`: è£…å‚™ã‚¹ã‚¿ã‚¤ãƒ«IDã®å…ˆé ­2æ–‡å­—ã‚’ `.` åŒºåˆ‡ã‚Šã§é€£çµ
  - standard â†’ `St`, highrisk â†’ `HR`, cautious â†’ `Ca`, quickjudge â†’ `QJ`, reversal â†’ `Re`
- `perkIds`: å–å¾—ãƒ‘ãƒ¼ã‚¯IDã®å…ˆé ­2æ–‡å­—ã‚’ `.` åŒºåˆ‡ã‚Šã§é€£çµ
  - vis_up â†’ `Vu`, score_up â†’ `Su`, combo_up â†’ `Cu`, shield â†’ `Sh`, slow â†’ `Sl`, heal â†’ `He`, right_x2 â†’ `Rx`, left_x2 â†’ `Lx`, gamble â†’ `Gk`, speed_score â†’ `Ss`, blind_any â†’ `Ba`, narrow â†’ `Nw`

**ä¾‹**:
- ã‚¹ã‚¿ã‚¤ãƒ«: highriskã€ãƒ‘ãƒ¼ã‚¯: ã‚®ãƒ£ãƒ³ãƒ–ãƒ©ãƒ¼ + åŠ é€Ÿå ±é…¬
  â†’ `s:HR_p:Gk.Ss`

#### 2.1.3 URLç”Ÿæˆãƒ»ãƒ‘ãƒ¼ã‚¹é–¢æ•°

```typescript
interface ShareParams {
  daily?: string;
  score: number;
  build: string;
  ghost?: string;
}

/** å…±æœ‰URLã‚’ç”Ÿæˆ */
function encodeShareUrl(params: ShareParams): string;

/** URLã‚¯ã‚¨ãƒªã‹ã‚‰å…±æœ‰ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹ */
function decodeShareUrl(search: string): ShareParams | null;

/** ãƒ“ãƒ«ãƒ‰æƒ…å ±ã‚’ã‚³ãƒ¼ãƒ‰ã«å¤‰æ› */
function encodeBuild(styles: string[], perks: PerkDef[]): string;

/** ãƒ“ãƒ«ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºç”¨ã«å¾©å…ƒ */
function decodeBuild(code: string): { styles: string[]; perks: string[] };
```

### 2.2 ã‚·ã‚§ã‚¢ã‚«ãƒ¼ãƒ‰UI

#### 2.2.1 ResultScreen ã® Props æ‹¡å¼µ

å…±æœ‰æ©Ÿèƒ½ã®ãŸã‚ã«ã€`ResultScreen` ã«è¿½åŠ æƒ…å ±ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚‹ã€‚

```typescript
interface Props {
  active: boolean;
  game: GameState | null;
  hasGold: boolean;
  // â”€â”€ æ–°è¦ Props â”€â”€
  equippedStyles?: string[];   // è£…å‚™ã‚¹ã‚¿ã‚¤ãƒ«IDï¼ˆãƒ“ãƒ«ãƒ‰ã‚³ãƒ¼ãƒ‰ç”Ÿæˆç”¨ï¼‰
  dailyId?: string;            // ãƒ‡ã‚¤ãƒªãƒ¼æ—¥æ¬¡IDï¼ˆãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰æ™‚ã®ã¿ï¼‰
  ghostData?: string;          // åœ§ç¸®æ¸ˆã¿ã‚´ãƒ¼ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆSprint 3 ã§è¿½åŠ ï¼‰
}
```

#### 2.2.2 ãƒªã‚¶ãƒ«ãƒˆç”»é¢ã®æ‹¡å¼µ

æ—¢å­˜ãƒªã‚¶ãƒ«ãƒˆç”»é¢ã®ä¸‹éƒ¨ã«ä»¥ä¸‹ã‚’è¿½åŠ :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ... æ—¢å­˜ãƒªã‚¶ãƒ«ãƒˆè¡¨ç¤º ...  â”‚
â”‚                          â”‚
â”‚  â”€â”€ SHARE â”€â”€             â”‚
â”‚  [ğŸ“¤ SHARE]  [ğŸ“‹ COPY]    â”‚
â”‚                          â”‚
â”‚  PRESS ANY BUTTON        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ã€ŒSHAREã€ãƒœã‚¿ãƒ³: `navigator.share` å¯¾å¿œæ™‚ã®ã¿è¡¨ç¤º
- ã€ŒCOPYã€ãƒœã‚¿ãƒ³: å¸¸ã«è¡¨ç¤º
- LCDè¡¨ç¾ã«åˆã‚ã›ã€ãƒœã‚¿ãƒ³ã¯ ASCII æ ç·šã§è¡¨ç¾

#### 2.2.3 å…±æœ‰ãƒ†ã‚­ã‚¹ãƒˆ

```
RISK LCD Daily 2026-02-17
Score: 3456 | Rank: A
Build: ãƒã‚¤ãƒªã‚¹ã‚¯ä¿¡è€… â†’ ã‚®ãƒ£ãƒ³ãƒ–ãƒ©ãƒ¼, åŠ é€Ÿå ±é…¬
{shareUrl}
```

- ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§ãªã„å ´åˆã¯ã€ŒDaily YYYY-MM-DDã€è¡Œã‚’çœç•¥

#### 2.2.4 å…±æœ‰å‡¦ç†ãƒ•ãƒ­ãƒ¼

1. ã€ŒSHAREã€ã‚¯ãƒªãƒƒã‚¯:
   ```typescript
   navigator.share({
     title: 'RISK LCD',
     text: shareText,
     url: shareUrl,
   });
   ```
2. ã€ŒCOPYã€ã‚¯ãƒªãƒƒã‚¯:
   ```typescript
   navigator.clipboard.writeText(shareUrl);
   // ã‚³ãƒ”ãƒ¼å®Œäº†ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¸€æ™‚å¤‰æ›´: "COPIED!"ï¼‰
   ```

### 2.3 å…±æœ‰URLå—ä¿¡å‡¦ç†

#### 2.3.1 å—ä¿¡ãƒ•ãƒ­ãƒ¼

1. `RiskLcdGame` ãƒã‚¦ãƒ³ãƒˆæ™‚ã« `window.location.search` ã‚’ãƒã‚§ãƒƒã‚¯
2. `rlcd=1` ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚Œã° `decodeShareUrl()` ã§ãƒ‘ãƒ¼ã‚¹
3. ãƒ‘ãƒ¼ã‚¹æˆåŠŸæ™‚:
   - `score` + `build` â†’ ç°¡æ˜“ãƒªã‚¶ãƒ«ãƒˆè¡¨ç¤ºï¼ˆé–²è¦§ãƒ¢ãƒ¼ãƒ‰ï¼‰
   - `daily` â†’ ãƒ‡ã‚¤ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¸ã®ã€ŒæŒ‘æˆ¦ã™ã‚‹ã€å°ç·šè¡¨ç¤º
   - `ghost` â†’ ã‚´ãƒ¼ã‚¹ãƒˆä»˜ããƒ—ãƒ¬ã‚¤å°ç·šï¼ˆSprint 3ï¼‰

#### 2.3.2 é–²è¦§ãƒ¢ãƒ¼ãƒ‰

- ãƒªã‚¶ãƒ«ãƒˆç”»é¢ã‚’èª­ã¿å–ã‚Šå°‚ç”¨ã§è¡¨ç¤º
- ã€ŒPLAYã€ãƒœã‚¿ãƒ³ã§é€šå¸¸ã‚²ãƒ¼ãƒ é–‹å§‹
- ã€ŒDAILYã€ãƒœã‚¿ãƒ³ã§ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰é–‹å§‹ï¼ˆdaily ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒä»Šæ—¥ã®å ´åˆã®ã¿ï¼‰

---

## 3. ã‚´ãƒ¼ã‚¹ãƒˆè¡¨ç¤ºï¼ˆæ“¬ä¼¼å¯¾æˆ¦ï¼‰

### 3.1 ã‚´ãƒ¼ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å½¢å¼

#### 3.1.1 è¨˜éŒ²ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

å„ã‚µã‚¤ã‚¯ãƒ«ã®è§£æ±ºæ™‚ï¼ˆresolve ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒ¬ãƒ¼ãƒ³ä½ç½®ã‚’è¨˜éŒ²:

```typescript
/** ã‚´ãƒ¼ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿: ã‚µã‚¤ã‚¯ãƒ«ã”ã¨ã®ãƒ¬ãƒ¼ãƒ³ä½ç½® */
type GhostLog = LaneIndex[]; // [1, 1, 0, 2, 1, 0, 0, 1, ...]
```

- è¨˜éŒ²ã‚¿ã‚¤ãƒŸãƒ³ã‚°: `resolve()` å‘¼ã³å‡ºã—ç›´å‰ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æœ€çµ‚ä½ç½®ï¼‰
- è¨˜éŒ²é‡: å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã®å…¨ã‚µã‚¤ã‚¯ãƒ«ï¼ˆæœ€å¤§: 8+10+12+14+16+20 = 80 ã‚¨ãƒ³ãƒˆãƒªï¼‰

#### 3.1.2 åœ§ç¸®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

**ãƒ©ãƒ³ãƒ¬ãƒ³ã‚°ã‚¹åœ§ç¸® + Base64url ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰**:

1. ãƒ©ãƒ³ãƒ¬ãƒ³ã‚°ã‚¹åœ§ç¸®:
   ```
   å…¥åŠ›: [1,1,1,0,0,2,2,2,2,1]
   åœ§ç¸®: [(1,3),(0,2),(2,4),(1,1)]
   ```

2. ãƒã‚¤ãƒŠãƒªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰:
   ```
   å„ãƒšã‚¢ (lane, count) ã‚’ 1ãƒã‚¤ãƒˆã«ãƒ‘ãƒƒã‚¯:
   ä¸Šä½2bit = lane (0-2), ä¸‹ä½6bit = count (1-63)
   ```

3. Base64url ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰:
   ```
   ãƒã‚¤ãƒŠãƒªé…åˆ— â†’ Base64url æ–‡å­—åˆ—ï¼ˆ`+` â†’ `-`, `/` â†’ `_`, ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãªã—ï¼‰
   ```

**æ¨å®šã‚µã‚¤ã‚º**: 80ã‚µã‚¤ã‚¯ãƒ« â†’ æœ€æ‚ª80ãƒã‚¤ãƒˆï¼ˆåœ§ç¸®å¾Œï¼‰â†’ Base64ã§ç´„107æ–‡å­—

#### 3.1.3 ã‚´ãƒ¼ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```typescript
class GhostRecorder {
  private log: LaneIndex[] = [];

  /** ã‚µã‚¤ã‚¯ãƒ«ã®ãƒ¬ãƒ¼ãƒ³ä½ç½®ã‚’è¨˜éŒ² */
  record(lane: LaneIndex): void;

  /** åœ§ç¸®æ–‡å­—åˆ—ã‚’ç”Ÿæˆ */
  compress(): string;

  /** ãƒ­ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ */
  reset(): void;
}

class GhostPlayer {
  private positions: LaneIndex[];

  constructor(compressed: string);

  /** æŒ‡å®š tickï¼ˆ0-indexedï¼‰ã®ãƒ¬ãƒ¼ãƒ³ä½ç½®ã‚’å–å¾— */
  getPosition(tick: number): LaneIndex;

  /** ç· tick æ•° */
  get length(): number;
}
```

### 3.2 ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—çµ±åˆ

#### 3.2.1 GameState æ‹¡å¼µ

```typescript
interface GameState {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...

  /** ãƒ‡ã‚¤ãƒªãƒ¼ãƒ¢ãƒ¼ãƒ‰ã‹ï¼ˆSprint 1 ã§è¿½åŠ ï¼‰ */
  dailyMode: boolean;
  /** ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã‹ï¼ˆSprint 4 ã§è¿½åŠ ï¼‰ */
  practiceMode: boolean;
  /** ã‚´ãƒ¼ã‚¹ãƒˆè¨˜éŒ²ç”¨ãƒ­ã‚°ï¼ˆå„ã‚µã‚¤ã‚¯ãƒ«ã® resolve æ™‚ã®ãƒ¬ãƒ¼ãƒ³ä½ç½®ã€0|1|2ï¼‰ */
  ghostLog: number[];
}
```

#### 3.2.2 è¨˜éŒ²ã‚¿ã‚¤ãƒŸãƒ³ã‚°

`useRunningPhase.ts` ã® `resolve()` é–¢æ•°å†…ã€åˆ¤å®šå‡¦ç†ã® **ç›´å‰** ã«è¨˜éŒ²:

```typescript
const resolve = (obs, cfg, pause) => {
  const g = gRef.current;
  if (!g?.alive) return;

  // ã‚´ãƒ¼ã‚¹ãƒˆè¨˜éŒ²
  g.ghostLog.push(g.lane);

  // ... æ—¢å­˜ã®åˆ¤å®šå‡¦ç† ...
};
```

### 3.3 ã‚´ãƒ¼ã‚¹ãƒˆå†ç”ŸUI

#### 3.3.1 è¡¨ç¤ºä»•æ§˜

- ã‚´ãƒ¼ã‚¹ãƒˆã¯ **å¯¾è±¡ãƒ¬ãƒ¼ãƒ³ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¡Œ5** ã«ç‚¹æ»…ã™ã‚‹ãƒ‰ãƒƒãƒˆã¨ã—ã¦è¡¨ç¤º
- è¡¨ç¤ºæ–‡å­—: `â—‡`ï¼ˆåŠé€æ˜çš„ãªLCDè¡¨ç¾ï¼‰
- ç‚¹æ»…ãƒ‘ã‚¿ãƒ¼ãƒ³: 500ms on / 300ms off
- è‰²: è–„ã„ç·‘ï¼ˆæ—¢å­˜LCDã‚«ãƒ©ãƒ¼ã®Î±å€¤ã‚’ä¸‹ã’ãŸè‰²ï¼‰

**å‘½åã«é–¢ã™ã‚‹æ³¨æ„**: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã§ã¯ `'ghost'` ãŒ `ArtKey`ï¼ˆéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¬ãƒ¼ãƒ³ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸åœ¨è¡¨ç¤ºï¼‰ãŠã‚ˆã³ `SegState`ï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆçŠ¶æ…‹ï¼‰ã§æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ã€‚ã‚´ãƒ¼ã‚¹ãƒˆå†ç”Ÿæ©Ÿèƒ½ã§ã¯ **`'ghostPlayer'`** ã‚’æ–°ãŸãª `SegState` å€¤ã¨ã—ã¦è¿½åŠ ã—ã€æ—¢å­˜ã® `'ghost'` ã¨ã¯æ˜ç¢ºã«åŒºåˆ¥ã™ã‚‹ã€‚

**SegState å‹ã®æ‹¡å¼µ**:
```typescript
// å¤‰æ›´å‰ï¼ˆuseGameEngine.tsï¼‰
export type SegState =
  | 'ghost' | 'warn' | 'danger' | 'impact'
  | 'safe' | 'near' | 'fake' | 'shield' | 'shieldWarn';

// å¤‰æ›´å¾Œ
export type SegState =
  | 'ghost' | 'warn' | 'danger' | 'impact'
  | 'safe' | 'near' | 'fake' | 'shield' | 'shieldWarn'
  | 'ghostPlayer';  // ã‚´ãƒ¼ã‚¹ãƒˆå†ç”Ÿè¡¨ç¤ºç”¨
```

#### 3.3.2 ã‚´ãƒ¼ã‚¹ãƒˆã® tick åŒæœŸ

- ã‚´ãƒ¼ã‚¹ãƒˆã® tick ã¯ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚µã‚¤ã‚¯ãƒ«ã‚«ã‚¦ãƒ³ãƒˆï¼ˆ`game.total`ï¼‰ã¨åŒæœŸ
- ã‚´ãƒ¼ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒç¾åœ¨ tick ã‚’è¶…ãˆãŸå ´åˆã¯æœ€å¾Œã®ä½ç½®ã§åœæ­¢

```
ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ total: 15 â†’ ghostPlayer.getPosition(15) â†’ ãƒ¬ãƒ¼ãƒ³ 2
â†’ ãƒ¬ãƒ¼ãƒ³ 2 ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¡Œ5 ã« â—‡ ã‚’è¡¨ç¤º
```

#### 3.3.3 å½“ãŸã‚Šåˆ¤å®š

- ã‚´ãƒ¼ã‚¹ãƒˆã¯ **ä¸€åˆ‡ã®å½“ãŸã‚Šåˆ¤å®šã‚’æŒãŸãªã„**
- ã‚´ãƒ¼ã‚¹ãƒˆãŒéšœå®³ãƒ¬ãƒ¼ãƒ³ã«ã„ã‚‹å ´åˆã‚‚ãã®ã¾ã¾è¡¨ç¤ºï¼ˆè¢«å¼¾æ¼”å‡ºãªã—ï¼‰

---

## 4. åˆå›ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

### 4.1 ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«

#### 4.1.1 è¡¨ç¤ºæ¡ä»¶

```
if (store.data.plays === 0 && !store.data.tutorialDone):
  GAME START â†’ TutorialScreen ã¸é·ç§»
else:
  GAME START â†’ é€šå¸¸ã‚²ãƒ¼ãƒ é–‹å§‹
```

- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ`plays > 0`ï¼‰ã¯è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: `SaveData` ãƒ­ãƒ¼ãƒ‰æ™‚ã« `plays > 0` ãªã‚‰ `tutorialDone = true` ã‚’è¨­å®š

#### 4.1.2 ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¹ãƒ†ãƒƒãƒ—

| Step | ã‚¿ã‚¤ãƒˆãƒ« | è¡¨ç¤ºå†…å®¹ | å›³è§£ |
|------|---------|---------|------|
| 1 | äºˆå‘Šã‚’èª­ã‚ | ä¸Šã‹ã‚‰è­¦å‘ŠãŒé™ã‚Šã¦ãã‚‹ã€‚é•·ã„ã»ã©æ—©ãæ°—ã¥ã‘ã‚‹ã€‚ | 3ãƒ¬ãƒ¼ãƒ³ã«è­¦å‘Šé™ä¸‹ã‚¢ãƒ‹ãƒ¡ |
| 2 | å›é¿ã›ã‚ˆ | â—€â–¶ ã§ãƒ¬ãƒ¼ãƒ³ç§»å‹•ã€‚å±é™ºãƒ¬ãƒ¼ãƒ³ã‹ã‚‰é€ƒã’ã‚ã€‚ | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒç§»å‹•ã™ã‚‹å›³ |
| 3 | å€ç‡ã¨ã‚¹ã‚³ã‚¢ | é«˜å€ç‡ãƒ¬ãƒ¼ãƒ³ã§å›é¿ = é«˜å¾—ç‚¹ã€‚ãƒªã‚¹ã‚¯ã¨ãƒªã‚¿ãƒ¼ãƒ³ã€‚ | ãƒ¬ãƒ¼ãƒ³å€ç‡è¡¨ç¤º Ã—1 / Ã—2 / Ã—4 |
| 4 | ãƒ“ãƒ«ãƒ‰ã‚’æ§‹ç¯‰ | ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ã§ãƒ‘ãƒ¼ã‚¯ç²å¾—ã€‚çµ„ã¿åˆã‚ã›ãŒæˆ¦ç•¥ã€‚ | ãƒ‘ãƒ¼ã‚¯é¸æŠç”»é¢ã®ç°¡æ˜“å›³ |

#### 4.1.3 ScreenId è¿½åŠ 

```typescript
// å¤‰æ›´å‰
export type ScreenId = 'T' | 'Y' | 'G' | 'H' | 'HP' | 'R';

// å¤‰æ›´å¾Œ
export type ScreenId = 'T' | 'D' | 'TU' | 'Y' | 'G' | 'H' | 'HP' | 'R';
// D = Daily, TU = Tutorial
```

#### 4.1.4 ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ç”»é¢UI

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TUTORIAL [1/4]          â”‚
â”‚                          â”‚
â”‚  â”€â”€ äºˆå‘Šã‚’èª­ã‚ â”€â”€         â”‚
â”‚                          â”‚
â”‚  ä¸Šã‹ã‚‰è­¦å‘ŠãŒ            â”‚
â”‚  é™ã‚Šã¦ãã‚‹ã€‚            â”‚
â”‚  é•·ã„ã»ã©æ—©ã            â”‚
â”‚  æ°—ã¥ã‘ã‚‹ã€‚              â”‚
â”‚                          â”‚
â”‚  [ç°¡æ˜“ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³]     â”‚
â”‚                          â”‚
â”‚  â— NEXT                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã¯ã€Œâ— STARTã€è¡¨ç¤º
- START æŠ¼ä¸‹ã§ `tutorialDone = true` ã‚’ä¿å­˜ã€ã‚²ãƒ¼ãƒ é–‹å§‹

### 4.2 ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰

#### 4.2.1 ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤‰æ›´

```
GAME START / DAILY / PRACTICE / PLAY STYLE / UNLOCK / HELP
```

- `PRACTICE` ã‚’ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ 2 ã«è¿½åŠ 

#### 4.2.2 ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ä»•æ§˜

| é …ç›® | é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ | ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ |
|------|----------|-----------|
| ã‚¹ãƒ†ãƒ¼ã‚¸æ•° | 5ã€œ6 | 1ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¸1å›ºå®šï¼‰ |
| ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ | ãƒ©ãƒ³ãƒ€ãƒ ï¼ˆST2ä»¥é™ï¼‰ | ãªã— |
| ãƒ‘ãƒ¼ã‚¯é¸æŠ | ã‚¹ãƒ†ãƒ¼ã‚¸ã‚¯ãƒªã‚¢æ™‚ | ãªã—ï¼ˆ1ã‚¹ãƒ†ãƒ¼ã‚¸ã®ã¿ï¼‰ |
| ã‚¹ã‚³ã‚¢è¨˜éŒ² | ãƒ™ã‚¹ãƒˆã‚¹ã‚³ã‚¢æ›´æ–° | è¨˜éŒ²ã—ãªã„ |
| PTç²å¾— | ã‚¹ã‚³ã‚¢ã®10% | ãªã—ï¼ˆ0PTï¼‰ |
| ãƒªã‚¶ãƒ«ãƒˆè¡¨ç¤º | é€šå¸¸ | ã€ŒPRACTICEã€ãƒ©ãƒ™ãƒ«ä»˜ã |

#### 4.2.3 å®Ÿè£…è©³ç´°

```typescript
// GameState ã«ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ãƒ•ãƒ©ã‚°è¿½åŠ 
interface GameState {
  // ... æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ ...
  practiceMode: boolean;
}

// startGame ã®æ‹¡å¼µ
function startGame(mode: 'normal' | 'daily' | 'practice' = 'normal') {
  // ...
  if (mode === 'practice') {
    g.maxStg = 0;  // ã‚¹ãƒ†ãƒ¼ã‚¸1ã®ã¿
    g.practiceMode = true;
  }
}

// useResultPhase ã® endGame æ‹¡å¼µ
function endGame(cleared: boolean) {
  // ...
  if (g.practiceMode) {
    ep = 0;           // PT ãªã—
    // updateBest() ã‚’ã‚¹ã‚­ãƒƒãƒ—
  }
}
```

#### 4.2.4 ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã®ãƒªã‚¶ãƒ«ãƒˆè¡¨ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PRACTICE CLEAR!         â”‚  â† "ALL CLEAR!" ã®ä»£ã‚ã‚Š
â”‚  B                       â”‚
â”‚  ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ã§ã™ã€‚         â”‚
â”‚                          â”‚
â”‚  SCORE    120            â”‚
â”‚  STAGE    1/1            â”‚
â”‚  ... çœç•¥ ...            â”‚
â”‚                          â”‚
â”‚  PTç²å¾—ãªã—              â”‚  â† "+XXpt" ã®ä»£ã‚ã‚Š
â”‚                          â”‚
â”‚  PRESS ANY BUTTON        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. SaveData ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### 5.1 æ–° SaveData å‹

```typescript
interface SaveData {
  pts: number;
  plays: number;
  best: number;
  bestSt: number;
  sty: string[];
  ui: string[];
  eq: string[];
  // â”€â”€ æ–°è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ â”€â”€
  daily?: DailyData;
  tutorialDone?: boolean;
}
```

### 5.2 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«

- æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ`plays > 0`ï¼‰: `tutorialDone = true` ã‚’è‡ªå‹•è¨­å®š
- `daily` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯æœªè¨­å®šã®å ´åˆ `undefined`ï¼ˆåˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«ç”Ÿæˆï¼‰
- `SAVE_KEY` ã¯ `'rlcd12'` ã‚’ç¶­æŒï¼ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ ã®ã¿ã€ç ´å£Šçš„å¤‰æ›´ãªã—ï¼‰

---

## 6. ãƒ†ã‚¹ãƒˆä»•æ§˜

### 6.1 ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå¯¾è±¡

| ãƒ•ã‚¡ã‚¤ãƒ« | ãƒ†ã‚¹ãƒˆå†…å®¹ |
|---------|----------|
| `utils/seeded-random.test.ts` | åŒä¸€ã‚·ãƒ¼ãƒ‰ã§åŒä¸€çµæœã€ç•°ãªã‚‹ã‚·ãƒ¼ãƒ‰ã§ç•°ãªã‚‹çµæœã€åˆ†å¸ƒã®åã‚Šæ¤œè¨¼ |
| `utils/share.test.ts` | URLç”Ÿæˆãƒ»ãƒ‘ãƒ¼ã‚¹ã®å¾€å¾©ãƒ†ã‚¹ãƒˆã€ä¸æ­£å…¥åŠ›ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° |
| `utils/ghost.test.ts` | è¨˜éŒ²â†’åœ§ç¸®â†’å±•é–‹ã®å¾€å¾©ãƒ†ã‚¹ãƒˆã€ç©ºãƒ‡ãƒ¼ã‚¿ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° |

### 6.2 ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä¾‹

```typescript
// seeded-random.test.ts
describe('SeededRand', () => {
  it('åŒä¸€ã‚·ãƒ¼ãƒ‰ã§åŒä¸€çµæœã‚’è¿”ã™', () => {
    const r1 = new SeededRand(42);
    const r2 = new SeededRand(42);
    expect(r1.int(100)).toBe(r2.int(100));
    expect(r1.int(100)).toBe(r2.int(100));
  });

  it('ç•°ãªã‚‹ã‚·ãƒ¼ãƒ‰ã§ç•°ãªã‚‹çµæœã‚’è¿”ã™', () => {
    const r1 = new SeededRand(42);
    const r2 = new SeededRand(99);
    // 10å›è©¦è¡Œã—ã¦å…¨ä¸€è‡´ã—ãªã„ã“ã¨ã‚’ç¢ºèª
    const matches = Array.from({ length: 10 }, () =>
      r1.int(1000) === r2.int(1000)
    );
    expect(matches.every(Boolean)).toBe(false);
  });
});

// ghost.test.ts
describe('GhostRecorder / GhostPlayer', () => {
  it('è¨˜éŒ²â†’åœ§ç¸®â†’å±•é–‹ã§å…ƒãƒ‡ãƒ¼ã‚¿ã¨ä¸€è‡´ã™ã‚‹', () => {
    const rec = new GhostRecorder();
    [1, 1, 1, 0, 0, 2, 2, 1].forEach(l => rec.record(l as LaneIndex));
    const compressed = rec.compress();
    const player = new GhostPlayer(compressed);
    expect(player.getPosition(0)).toBe(1);
    expect(player.getPosition(2)).toBe(1);
    expect(player.getPosition(3)).toBe(0);
    expect(player.getPosition(5)).toBe(2);
    expect(player.getPosition(7)).toBe(1);
  });
});
```
