# 迷宮の残響 ブラッシュアップ — タスクチェックリスト

## 凡例

- **I**: 実施タスク (Implementation)
- **V**: 検証タスク (Verification)
- **前提**: そのタスクを開始するために必要な先行タスク
- **受入条件**: タスク完了と判断するための条件

---

## フェーズ1: ビジュアル演出の革新

### I-1.1: `images.ts` の拡張設計

- **対象ファイル**: `src/features/labyrinth-echo/images.ts`
- **前提**: なし
- **作業内容**:
  - `LE_BG_IMAGES`（フロア背景）、`LE_SCENE_IMAGES`（シーンイラスト）、`LE_OVERLAY_IMAGES`（状態異常）、`LE_TITLE_LAYERS`（タイトル）の型定義と空のエクスポートを追加
  - 新規画像のimport構造を準備（プレースホルダー対応）
- **受入条件**:
  - [ ] 新しい画像カテゴリの型定義が追加されている
  - [ ] TypeScriptコンパイルが通る
  - [ ] 既存の `LE_IMAGES` に影響がない

### I-1.2: パララックス背景コンポーネントの実装

- **対象ファイル**: `src/features/labyrinth-echo/components/ParallaxBg.tsx` (新規)
- **前提**: I-1.1
- **作業内容**:
  - `ParallaxBg` コンポーネントの実装
  - 3レイヤー（far/mid/near）の構成
  - フロア番号に応じた画像切り替え
  - スクロール連動のパララックスエフェクト
  - フロア遷移時のフェードアニメーション
- **受入条件**:
  - [ ] 5フロアそれぞれで異なる背景が表示される
  - [ ] スクロールに連動して各レイヤーが異なる速度で動く
  - [ ] フロア遷移時にフェードアウト/フェードインが発生する
  - [ ] 画像未ロード時にエラーなく表示される

### I-1.3: `Page.tsx` へのパララックス背景統合

- **対象ファイル**: `src/features/labyrinth-echo/components/Page.tsx`
- **前提**: I-1.2
- **作業内容**:
  - `ParallaxBg` コンポーネントをPage内に配置
  - 既存の背景グラデーションとの共存
  - フロア番号のprops受け渡し
- **受入条件**:
  - [ ] パララックス背景がゲーム画面に表示される
  - [ ] 既存のパーティクルエフェクトとの共存が正常
  - [ ] 既存のビネット/ブラーエフェクトが正常に動作する

### I-1.4: イベント画像選択ロジックの実装

- **対象ファイル**: `src/features/labyrinth-echo/components/EventResultScreen.tsx`
- **前提**: I-1.1
- **作業内容**:
  - `getEventImage()` 関数の実装（固有画像 → 種別共通画像のフォールバック）
  - イベント画像の表示サイズを 120px → 200px に拡大
  - 画像フェードインアニメーションの追加
- **受入条件**:
  - [ ] 固有画像があるイベントで専用画像が表示される
  - [ ] 固有画像がないイベントで種別共通画像にフォールバックする
  - [ ] 画像がフェードインで表示される
  - [ ] 画像サイズが200pxに拡大されている

### I-1.5: 状態異常ビジュアルオーバーレイコンポーネントの実装

- **対象ファイル**: `src/features/labyrinth-echo/components/StatusOverlay.tsx` (新規)
- **前提**: I-1.1
- **作業内容**:
  - `StatusOverlay` コンポーネントの実装
  - 各状態異常に対応するオーバーレイ画像の表示
  - CSSアニメーション（回転・パルス・スライド）
  - 複数状態異常の重複表示とopacity調整
- **受入条件**:
  - [ ] 5種の状態異常それぞれに対応するオーバーレイが表示される
  - [ ] 各オーバーレイのアニメーションが仕様通り動作する
  - [ ] 複数状態異常時のopacity合計が0.5を超えない
  - [ ] ゲームコンテンツの視認性が損なわれない

### I-1.6: ゲーム画面への状態異常オーバーレイ統合

- **対象ファイル**: `src/features/labyrinth-echo/LabyrinthEchoGame.tsx`
- **前提**: I-1.5
- **作業内容**:
  - `StatusOverlay` をイベント画面・結果画面に配置
  - プレイヤーの状態異常リストをpropsとして渡す
  - z-indexの調整（コンテンツの上、モーダルの下）
- **受入条件**:
  - [ ] 状態異常時にオーバーレイが画面上に表示される
  - [ ] 状態異常が治癒するとオーバーレイが消える
  - [ ] 選択肢ボタンの操作性に影響がない

### I-1.7: エンディングCG演出の強化

- **対象ファイル**: `src/features/labyrinth-echo/components/EndScreens.tsx`
- **前提**: なし
- **作業内容**:
  - エンディング画像のフルスクリーン背景化
  - ブラー → シャープの段階的表示アニメーション
  - 画像上のパーティクルオーバーレイ
  - エンディングテキストのセミトランスペアレント背景
- **受入条件**:
  - [ ] エンディング画像がフルスクリーン背景として表示される
  - [ ] ブラーからシャープへの遷移が滑らか
  - [ ] テキストが画像の上で読みやすい
  - [ ] 11種全てのエンディングで正常に表示される

### I-1.8: タイトル画面パララックスの実装

- **対象ファイル**: `src/features/labyrinth-echo/components/TitleScreen.tsx`
- **前提**: I-1.1
- **作業内容**:
  - 3レイヤー構成のタイトル背景（遠景・中景 + 既存タイトル画像）
  - マウス移動に反応するパララックス効果
  - タイトルテキストのグリッチ/歪みエフェクト追加
- **受入条件**:
  - [ ] マウス移動に応じて背景レイヤーが微かに動く
  - [ ] モバイルではパララックスが無効化される（パフォーマンス考慮）
  - [ ] 既存のタイトルアニメーション（glow）が正常に動作する

### I-1.9: フロア背景画像の生成（15枚）

- **前提**: I-1.2
- **作業内容**:
  - 画像生成AIを使用して5フロア × 3レイヤー = 15枚の背景画像を生成
  - spec.md の画像仕様に準拠
  - `src/assets/images/` に配置
  - 前景レイヤーは大部分が透明であること
- **受入条件**:
  - [ ] 15枚のWebP画像が生成・配置されている
  - [ ] 各画像が960×540 px、300KB以内
  - [ ] 前景レイヤーの中央部が透明
  - [ ] フロアごとの世界観が画像で表現されている

### I-1.10: イベントシーンイラストの生成（15枚）

- **前提**: I-1.4
- **作業内容**:
  - 画像生成AIを使用して15枚のイベントシーン画像を生成
  - ボス戦、各フロアキーイベント、チェインクライマックス、クロスラン、状態異常
  - spec.md の画像仕様に準拠
  - `src/assets/images/` に配置
  - `images.ts` の `LE_SCENE_IMAGES` に登録
- **受入条件**:
  - [ ] 15枚のWebP画像が生成・配置されている
  - [ ] 各画像が960×540 px、300KB以内
  - [ ] `LE_SCENE_IMAGES` に全画像が登録されている
  - [ ] 該当イベントで固有画像が表示される

### I-1.11: 状態異常オーバーレイ画像の生成（5枚）

- **前提**: I-1.5
- **作業内容**:
  - 画像生成AIを使用して5枚のオーバーレイ画像を生成
  - 中央が透明、効果は画面端に集中
  - spec.md のオーバーレイ仕様に準拠
  - `src/assets/images/` に配置
  - `images.ts` の `LE_OVERLAY_IMAGES` に登録
- **受入条件**:
  - [ ] 5枚のWebP画像が生成・配置されている
  - [ ] 中央部が透明で視認性を確保
  - [ ] 各画像が300KB以内
  - [ ] CSSアニメーションとの組み合わせで意図した効果が出る

### I-1.12: タイトル画面パララックス画像の生成（2枚）

- **前提**: I-1.8
- **作業内容**:
  - 画像生成AIを使用して遠景・中景の2枚を生成
  - spec.md の仕様に準拠
- **受入条件**:
  - [ ] 2枚のWebP画像が生成・配置されている
  - [ ] 既存のタイトル画像とのレイヤー構成が自然

### V-1.1: ビジュアル演出の統合検証

- **前提**: I-1.3, I-1.6, I-1.7, I-1.8, I-1.9, I-1.10, I-1.11, I-1.12
- **作業内容**:
  - 全フロアでのパララックス背景表示確認
  - 固有画像イベントの表示確認
  - 全5状態異常のオーバーレイ表示確認
  - エンディングCG演出の全11種確認
  - タイトル画面パララックスの確認
  - モバイルでのレイアウト確認
- **受入条件**:
  - [ ] 全ビジュアル演出がエラーなく表示される
  - [ ] 画像ロードの失敗時にフォールバックが動作する
  - [ ] モバイルでレイアウトが崩れない
  - [ ] 60fpsを維持（デスクトップ）

### V-1.2: パフォーマンス検証（画像）

- **前提**: V-1.1
- **作業内容**:
  - 画像のプリロード動作確認
  - 初回ロード時間の計測
  - メモリ使用量の確認（多数の画像同時表示時）
  - Lazy Loading の動作確認
- **受入条件**:
  - [ ] フロア遷移時に画像のちらつきがない
  - [ ] 初回ロードが許容範囲内
  - [ ] メモリ使用量が安定

---

## フェーズ2: サウンドスケープ強化

### I-2.1: AudioEngine のBGM機能追加

- **対象ファイル**: `src/features/labyrinth-echo/audio.ts`
- **前提**: なし
- **作業内容**:
  - `bgm` オブジェクトの追加（startFloorBgm, stopBgm, setEventMood, setBgmVolume）
  - BGMノード構成の実装（Oscillator → Gain → Filter → Master）
  - LFO変調の実装
  - フェードイン/フェードアウト処理
- **受入条件**:
  - [ ] `startFloorBgm(1)` 〜 `startFloorBgm(5)` で異なるBGMが再生される
  - [ ] `stopBgm()` でフェードアウト停止する
  - [ ] BGMが途切れずループ再生される
  - [ ] 既存の効果音と干渉しない

### I-2.2: フロア別BGMパラメータの設定

- **対象ファイル**: `src/features/labyrinth-echo/audio.ts`
- **前提**: I-2.1
- **作業内容**:
  - 5フロア分のBGMパラメータ定数を定義
  - フロア番号に応じたパラメータ切り替えロジック
  - spec.md のパラメータ表に準拠
- **受入条件**:
  - [ ] 各フロアで異なる雰囲気のBGMが再生される
  - [ ] 第1層は穏やか、第5層は緊迫した音響になっている
  - [ ] パラメータ遷移が滑らか

### I-2.3: イベントムードBGM変化の実装

- **対象ファイル**: `src/features/labyrinth-echo/audio.ts`
- **前提**: I-2.2
- **作業内容**:
  - `setEventMood()` によるBGMパラメータのリアルタイム変更
  - イベント種別（探索/遭遇/罠/安息/ボス）に応じた変化
  - 500ms かけたパラメータ遷移
- **受入条件**:
  - [ ] 遭遇イベントでBGMのテンポ感が上がる
  - [ ] 安息イベントでBGMが穏やかになる
  - [ ] ボスイベントで最も緊迫したBGMになる
  - [ ] パラメータ遷移が急激でなく滑らか

### I-2.4: 危機時BGM変化の実装

- **対象ファイル**: `src/features/labyrinth-echo/audio.ts`
- **前提**: I-2.2
- **作業内容**:
  - HP/MN低下時のBGMフィルター変化
  - HP25%以下での不協和音追加
  - MN15%以下でのディストーション追加
- **受入条件**:
  - [ ] HP低下時にBGMが暗くこもった音になる
  - [ ] HP25%以下でBGMに不気味な不協和音が加わる
  - [ ] MN低下時にBGMの揺らぎが大きくなる
  - [ ] HP/MN回復時にBGMが通常に戻る

### I-2.5: ゲームフローへのBGM統合

- **対象ファイル**: `src/features/labyrinth-echo/LabyrinthEchoGame.tsx`
- **前提**: I-2.3, I-2.4
- **作業内容**:
  - フロア進入時の `startFloorBgm()` 呼び出し
  - イベント表示時の `setEventMood()` 呼び出し
  - HP/MN変化時のBGM更新
  - ゲームオーバー/勝利時の `stopBgm()` 呼び出し
  - タイトル画面遷移時のBGM停止
- **受入条件**:
  - [ ] フロア進入と同時にBGMが開始される
  - [ ] イベント種別の変化にBGMが追従する
  - [ ] ゲームオーバー/勝利でBGMがフェードアウトする
  - [ ] タイトルに戻るとBGMが停止する

### I-2.6: 追加効果音の実装

- **対象ファイル**: `src/features/labyrinth-echo/audio.ts`
- **前提**: なし
- **作業内容**:
  - `page`, `unlock`, `titleGlow`, `endingFanfare`, `curseApply`, `secondLife` の6効果音を追加
  - spec.md のパラメータに準拠
- **受入条件**:
  - [ ] 6種の新効果音が再生される
  - [ ] 既存の効果音と音量バランスが取れている
  - [ ] 各効果音が意図した場面で再生される

### I-2.7: 音声設定UIの拡張

- **対象ファイル**: `src/features/labyrinth-echo/components/SettingsScreens.tsx`
- **前提**: I-2.1
- **作業内容**:
  - BGM ON/OFF トグルの追加
  - BGM/SFXボリュームスライダーの追加
  - 設定値のlocalStorage保存/読み込み
  - ゲーム中の音声トグルボタンの分離（BGM/SFX個別）
- **受入条件**:
  - [ ] BGMのON/OFFが切り替えられる
  - [ ] ボリューム調整がリアルタイムに反映される
  - [ ] 設定値がlocalStorageに保存され、次回起動時に復元される

### V-2.1: サウンドスケープ統合検証

- **前提**: I-2.5, I-2.6, I-2.7
- **作業内容**:
  - 全5フロアのBGM確認
  - 全イベント種別でのムード変化確認
  - 危機時BGM変化の確認
  - 効果音のタイミング確認
  - 音声ON/OFFの動作確認
  - BGM + SFX同時再生の負荷確認
- **受入条件**:
  - [ ] 全BGMが途切れず再生される
  - [ ] BGMと効果音の音量バランスが適切
  - [ ] 音声設定の保存/復元が正常
  - [ ] 音声再生によるパフォーマンス低下がない

---

## フェーズ3: ゲームプレイ深化

### I-3.1: キーボード操作フックの実装

- **対象ファイル**: `src/features/labyrinth-echo/hooks.ts` (または新規ファイル)
- **前提**: なし
- **作業内容**:
  - `useKeyboardControls` フックの実装
  - キーマッピング（1/2/3: 選択肢、Enter/Space: 決定、Escape: タイトル、L: ログ、M: 音声）
  - フェーズに応じたキー操作の有効/無効切り替え
  - テキスト表示中は選択肢キーを無効化
  - `event.repeat` チェックによる連打防止
- **受入条件**:
  - [ ] 数字キーで選択肢を選択できる
  - [ ] Enter/Spaceでテキスト送りと決定ができる
  - [ ] Escapeでタイトル画面に戻れる（確認ダイアログ付き）
  - [ ] テキスト表示中は選択肢キーが無効
  - [ ] 既存のマウス操作に影響がない

### I-3.2: キーボードインジケーターの追加

- **対象ファイル**: `src/features/labyrinth-echo/components/EventResultScreen.tsx`
- **前提**: I-3.1
- **作業内容**:
  - 選択肢ボタンの左端に `[1]` `[2]` `[3]` のキーバインド表示を追加
  - モバイルデバイスでは非表示（`@media (hover: hover)` で判定）
  - スタイル: font-size 0.7em, opacity 0.5
- **受入条件**:
  - [ ] デスクトップでキーバインドが表示される
  - [ ] モバイルでは非表示
  - [ ] 選択肢のレイアウトが崩れない

### I-3.3: 情報値ヒントの強化

- **対象ファイル**: `src/features/labyrinth-echo/components/EventResultScreen.tsx`
- **前提**: なし
- **作業内容**:
  - INF 20以上: 条件の閾値レンジをテキストで表示
  - INF 30以上: 結果カテゴリのアイコン表示
  - ヒント表示のフェードインアニメーション
  - 条件文字列を人間可読テキストに変換する関数の実装
- **受入条件**:
  - [ ] INF 20以上で閾値レンジのヒントが表示される
  - [ ] INF 30以上で結果カテゴリアイコンが表示される
  - [ ] ヒントがフェードインで表示される
  - [ ] 条件変換が全パターンで正しく動作する

### I-3.4: 探索ログの改善

- **対象ファイル**: `src/features/labyrinth-echo/components/GameComponents.tsx`
- **前提**: なし
- **作業内容**:
  - ステータス変化の色分け表示（HP緑/赤、MN青/紫、INF黄/灰）
  - フロアごとのセパレーター表示
  - ログフィルターUI（全て/ダメージ/回復/フラグ）
  - ログのクリップボードコピー機能
- **受入条件**:
  - [ ] ステータス変化が色分けされて表示される
  - [ ] フロアの区切りが明確に分かる
  - [ ] フィルターで表示項目を切り替えられる
  - [ ] ログのコピーが動作する

### I-3.5: 難易度バランスの微調整

- **対象ファイル**: `src/features/labyrinth-echo/definitions.ts`, `src/features/labyrinth-echo/events/event-utils.ts`
- **前提**: なし
- **作業内容**:
  - 探索者（Easy）の侵蝕値を微減（初見プレイヤーの到達率向上）
  - 安息イベントの出現率を全難易度で微増
  - ボスイベント(e030)のINF依存ヒント段階開示
- **受入条件**:
  - [ ] 探索者で初見プレイヤーが第3層まで到達しやすくなる
  - [ ] 安息イベントの出現率が上がっている
  - [ ] ボスイベントでINFが高いとヒントが見える
  - [ ] 他の難易度のバランスに大きな影響がない

### I-3.6: 初回プレイガイダンスの実装

- **対象ファイル**: 新規 + 既存コンポーネントの修正
- **前提**: なし
- **作業内容**:
  - ガイダンスオーバーレイUIの実装（ハイライト + ツールチップ）
  - 4ステップのガイダンスフロー
  - localStorage による表示制御（初回のみ）
  - 「OK」ボタンと「スキップ」ボタン
  - ステータスバーの常時ツールチップ追加
- **受入条件**:
  - [ ] 初回プレイ時にガイダンスが表示される
  - [ ] 2回目以降は表示されない
  - [ ] 各ステップで正しい要素がハイライトされる
  - [ ] 「スキップ」で即座に完了する
  - [ ] ステータスバーのツールチップが常時利用可能

### V-3.1: ゲームプレイ改善の統合検証

- **前提**: I-3.1 〜 I-3.6
- **作業内容**:
  - キーボード操作の全画面テスト
  - INFヒントの全レベルテスト
  - ログ機能の全フィルターテスト
  - 初回ガイダンスの通しテスト
  - 難易度バランスの確認（探索者で複数回プレイ）
- **受入条件**:
  - [ ] キーボードとマウスの併用が問題なく動作する
  - [ ] INFヒントが正しいINF値で表示される
  - [ ] ログ機能が全フェーズで正常動作する
  - [ ] ガイダンスが初回のみ表示される
  - [ ] 難易度バランスが適切

---

## フェーズ4: エンゲージメント強化

### I-4.1: シェアカード生成機能の実装

- **対象ファイル**: `src/features/labyrinth-echo/share-card.ts` (新規)
- **前提**: なし
- **作業内容**:
  - `generateShareCard()` 関数の実装
  - Canvas APIによるカード画像の動的生成
  - エンディング画像 + 統計情報のレイアウト
  - PNG/WebPのdata URL出力
- **受入条件**:
  - [ ] 600×315pxのシェアカード画像が生成される
  - [ ] エンディング画像が背景に表示される
  - [ ] HP/MN/INF/階層/状態異常が表示される
  - [ ] テキストが読みやすいフォントサイズ

### I-4.2: シェアUIの実装

- **対象ファイル**: `src/features/labyrinth-echo/components/EndScreens.tsx`
- **前提**: I-4.1
- **作業内容**:
  - 勝利画面に「シェア」セクションを追加
  - 「画像を保存」ボタン（Canvas → PNG → ダウンロード）
  - 「Xでシェア」ボタン（Web Intent URL）
  - 「テキストコピー」ボタン（clipboard API）
  - ゲームオーバー画面にもシンプルなシェアボタンを追加
- **受入条件**:
  - [ ] 勝利画面にシェアセクションが表示される
  - [ ] 画像ダウンロードが動作する
  - [ ] X(Twitter)の投稿画面が開く
  - [ ] テキストコピーが動作する
  - [ ] シェアカードのプレビューが表示される

### I-4.3: 実績通知トーストの実装

- **対象ファイル**: `src/features/labyrinth-echo/components/AchievementToast.tsx` (新規)
- **前提**: なし
- **作業内容**:
  - `AchievementToast` コンポーネントの実装
  - 4タイプの通知スタイル（unlock/title/ending/achievement）
  - スライドイン → 維持(3秒) → フェードアウト のアニメーション
  - 効果音の連携
- **受入条件**:
  - [ ] トースト通知が画面右下に表示される
  - [ ] スライドイン/フェードアウトアニメーションが動作する
  - [ ] 4タイプで異なるスタイル（色・アイコン）が表示される
  - [ ] ゲーム操作を妨げない

### I-4.4: 実績通知トリガーの統合

- **対象ファイル**: `src/features/labyrinth-echo/LabyrinthEchoGame.tsx`
- **前提**: I-4.3
- **作業内容**:
  - アンロック解放時のトースト表示
  - 称号取得時のトースト表示
  - エンディング初回到達時のトースト表示
  - トースト表示のキュー管理（複数同時発生時の順次表示）
- **受入条件**:
  - [ ] アンロック解放時にトースト通知が表示される
  - [ ] 称号取得時にトースト通知が表示される
  - [ ] 複数の通知が順次表示される（重ならない）

### V-4.1: エンゲージメント機能の検証

- **前提**: I-4.2, I-4.4
- **作業内容**:
  - 全11エンディングでのシェアカード生成確認
  - シェアボタンの全プラットフォーム動作確認
  - トースト通知のタイミング確認
  - モバイルでのシェア機能確認
- **受入条件**:
  - [ ] 全エンディングで正しいシェアカードが生成される
  - [ ] シェア機能がChrome/Firefox/Safariで動作する
  - [ ] トースト通知が適切なタイミングで表示される

---

## フェーズ5: 品質改善

### I-5.1: @ts-nocheck の除去（高優先度ファイル）

- **対象ファイル**: `game-logic.ts`, `events/event-utils.ts`
- **前提**: なし
- **作業内容**:
  - `@ts-nocheck` の削除
  - TypeScriptコンパイルエラーの修正
  - `any` → `unknown` + 型ガードへの置換
  - 既存テストの維持
- **受入条件**:
  - [ ] `@ts-nocheck` が除去されている
  - [ ] TypeScriptコンパイルが通る
  - [ ] 既存テストが全てパスする
  - [ ] `any` 型が使用されていない

### I-5.2: @ts-nocheck の除去（中優先度ファイル）

- **対象ファイル**: `LabyrinthEchoGame.tsx`, `components/*.tsx`
- **前提**: I-5.1
- **作業内容**:
  - `@ts-nocheck` の削除と型エラーの修正
  - コンポーネントの Props 型定義の補完
- **受入条件**:
  - [ ] 全コンポーネントで `@ts-nocheck` が除去されている
  - [ ] TypeScriptコンパイルが通る
  - [ ] 既存テストが全てパスする

### I-5.3: イベントデータの型整合性テスト追加

- **対象ファイル**: `src/features/labyrinth-echo/__tests__/event-data.test.ts` (新規)
- **前提**: なし
- **作業内容**:
  - 163件のイベントデータの構造検証テスト
  - 必須フィールドの存在確認
  - 条件文字列フォーマットの検証
  - チェインイベント参照先の存在確認
  - フロア指定の範囲検証
- **受入条件**:
  - [ ] 全イベントの構造が検証される
  - [ ] 条件文字列フォーマットが正しい
  - [ ] チェインイベントの参照先が全て存在する
  - [ ] テストが全てパスする

### I-5.4: UIコンポーネントテストの追加

- **対象ファイル**: `src/features/labyrinth-echo/__tests__/` に新規テスト
- **前提**: なし
- **作業内容**:
  - TitleScreen のテスト（表示切り替え、ボタン動作）
  - EventResultScreen のテスト（テキスト表示、選択肢）
  - DiffSelectScreen のテスト（難易度カード表示）
  - EndScreens のテスト（エンディング表示）
- **受入条件**:
  - [ ] 主要4コンポーネントのテストが作成されている
  - [ ] テストが全てパスする
  - [ ] カバレッジ目標（70%以上）を達成

### I-5.5: 画像プリロード機構の実装

- **対象ファイル**: `src/features/labyrinth-echo/hooks.ts`
- **前提**: I-1.1
- **作業内容**:
  - `useImagePreload` フックの実装
  - 次フロアの背景画像のプリロード
  - Intersection Observer を使用したLazy Loading
- **受入条件**:
  - [ ] フロア遷移前に次フロアの画像がプリロードされる
  - [ ] 画像未ロード時にフォールバックが表示される
  - [ ] 不要な画像がメモリから解放される

### V-5.1: 品質改善の検証

- **前提**: I-5.1 〜 I-5.5
- **作業内容**:
  - `npm run build` でプロダクションビルド成功確認
  - 全テストスイートの実行
  - TypeScriptの厳格モードでのコンパイル確認
- **受入条件**:
  - [ ] ビルド成功
  - [ ] 全テストパス
  - [ ] TypeScriptエラーなし

---

## フェーズ6: 統合テスト・ポリッシュ

### I-6.1: 全画面遷移の通しテスト

- **前提**: 全フェーズ 1〜5 タスク完了
- **作業内容**:
  - タイトル → 難易度選択 → フロアイントロ → イベント(×3) → 結果 → フロアイントロ(2) → ... → ゲームオーバー の通しテスト
  - タイトル → ... → 勝利 → シェア の通しテスト
  - アンロック画面、称号画面、実績画面、設定画面の動作確認
  - キーボード操作での全画面遷移テスト
- **受入条件**:
  - [ ] マウス操作で全遷移がエラーなく完了する
  - [ ] キーボード操作で全遷移がエラーなく完了する
  - [ ] コンソールにエラー・警告がない

### I-6.2: ブラウザ互換性テスト

- **前提**: I-6.1
- **作業内容**:
  - Chrome (デスクトップ) での全機能確認
  - Firefox (デスクトップ) での全機能確認
  - Safari (デスクトップ) での全機能確認
  - モバイルブラウザでの全機能確認
  - Web Audio APIの互換性確認（特にBGM）
- **受入条件**:
  - [ ] 主要3ブラウザで全機能が動作する
  - [ ] モバイルでレイアウトが崩れない
  - [ ] BGMが全ブラウザで再生される

### I-6.3: パフォーマンス検証

- **前提**: I-6.1
- **作業内容**:
  - 画像ロードの初回表示時間計測
  - BGM + SFX同時再生時のオーディオ負荷
  - 状態異常オーバーレイ + パララックス + パーティクル同時描画の負荷
  - メモリリーク検証（10分連続プレイ想定）
- **受入条件**:
  - [ ] 初回ロードが5秒以内（3G回線除く）
  - [ ] デスクトップで60fps維持
  - [ ] モバイルで30fps以上維持
  - [ ] メモリ使用量が安定

### I-6.4: 最終ポリッシュ

- **前提**: I-6.2, I-6.3
- **作業内容**:
  - アニメーションタイミングの微調整
  - BGMのボリュームバランス微調整
  - 画像のフィルター・透明度の微調整
  - テキスト表示速度の最適化
  - UIの統一感確認と修正
- **受入条件**:
  - [ ] アニメーションが自然に見える
  - [ ] BGMのボリュームが適切
  - [ ] 画像の表示が世界観と調和している
  - [ ] 全体的なUIが統一されている

### V-6.1: 最終受入テスト

- **前提**: I-6.4
- **作業内容**:
  - 全エンディング到達テスト（11種）
  - 全難易度でのプレイテスト（4難易度）
  - シェアカード生成の全パターンテスト
  - 初回/2回目以降の表示切り替えテスト
  - `npm run build` プロダクションビルド最終確認
  - 全テストスイート実行
- **受入条件**:
  - [ ] 全11エンディングに到達可能
  - [ ] 全4難易度でプレイ可能
  - [ ] シェアカードが全パターンで生成される
  - [ ] ビルド成功
  - [ ] 全テストパス
  - [ ] ゲーム体験が一貫して高品質

---

## タスク依存関係図

```
I-1.1 ──┬──→ I-1.2 ──→ I-1.3 ──┐
         │                        │
         ├──→ I-1.4 ──────────────┤
         │                        │
         ├──→ I-1.5 ──→ I-1.6 ──┤
         │                        │
         └──→ I-1.8 ──────────────┤
                                   │
I-1.7 ─────────────────────────────┤
                                   │
I-1.9/10/11/12 (画像生成) ─────────┤
                                   │
                                   ├──→ V-1.1 ──→ V-1.2
                                   │
I-2.1 ──→ I-2.2 ──┬──→ I-2.3 ──┐│
                    │             ││
                    └──→ I-2.4 ──┤│
                                  ││
I-2.6 ────────────────────────────┤│
                                  ││
I-2.7 ────────────────────────────┤│
                                  ││
                                  ├──→ I-2.5 ──→ V-2.1
                                  │
I-3.1 ──→ I-3.2 ──┐              │
                    │              │
I-3.3 ─────────────┤              │
I-3.4 ─────────────┤              │
I-3.5 ─────────────┤              │
I-3.6 ─────────────┼──→ V-3.1   │
                                   │
I-4.1 ──→ I-4.2 ──┐              │
I-4.3 ──→ I-4.4 ──┼──→ V-4.1   │
                                   │
I-5.1 ──→ I-5.2 ──┐              │
I-5.3 ─────────────┤              │
I-5.4 ─────────────┤              │
I-5.5 ─────────────┼──→ V-5.1   │
                                   │
V-1.2 ─┐                          │
V-2.1 ─┤                          │
V-3.1 ─┼──→ I-6.1 ──→ I-6.2 ──→ I-6.3 ──→ I-6.4 ──→ V-6.1
V-4.1 ─┤
V-5.1 ─┘
```

---

## サマリー

| フェーズ | I タスク数 | V タスク数 | 合計 |
|---------|-----------|-----------|------|
| フェーズ 1: ビジュアル演出 | 12 | 2 | 14 |
| フェーズ 2: サウンドスケープ | 7 | 1 | 8 |
| フェーズ 3: ゲームプレイ | 6 | 1 | 7 |
| フェーズ 4: エンゲージメント | 4 | 1 | 5 |
| フェーズ 5: 品質改善 | 5 | 1 | 6 |
| フェーズ 6: 統合・ポリッシュ | 4 | 1 | 5 |
| **合計** | **38** | **7** | **45** |
