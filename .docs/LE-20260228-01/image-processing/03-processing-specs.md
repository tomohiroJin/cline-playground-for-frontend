# 透過処理技術仕様

## 1. 楕円グラデーションマスク（オーバーレイ用 × 5枚）

### 対象
- `le_overlay_injured.webp`
- `le_overlay_bleeding.webp`
- `le_overlay_fear.webp`
- `le_overlay_curse.webp`
- `le_overlay_confused.webp`

### 目的
中央を透明にし、端のエフェクト（血飛沫、霧、蔓など）を残す。
ステータス異常時に画面の端にエフェクトが表示される。

### パラメータ
```
inner_radius: 0.28  # 中央28%は完全透明 (alpha=0)
outer_radius: 0.62  # 外側62%から完全不透明 (alpha=255)
補間方式: コサイン補間（滑らかなフェード）
```

### マスク形状
```
┌──────────────────┐
│▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│  ← 端: エフェクト残る (alpha=255)
│▓▓▒▒▒▒▒▒▒▒▒▒▒▒▓▓│  ← 遷移ゾーン (alpha: 255→0)
│▓▒░░░░░░░░░░░░▒▓│
│▓▒░            ░▒▓│  ← 中央: 完全透明 (alpha=0)
│▓▒░░░░░░░░░░░░▒▓│
│▓▓▒▒▒▒▒▒▒▒▒▒▒▒▓▓│
│▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓│
└──────────────────┘
```

### アルゴリズム
1. 画像の中心から各ピクセルまでの正規化距離 `d` を計算（楕円距離）
2. `d < inner_radius` → alpha = 0
3. `d > outer_radius` → alpha = 255
4. その間 → コサイン補間: `alpha = (1 - cos(π * t)) / 2 * 255` (`t = (d - inner) / (outer - inner)`)

---

## 2. 矩形ビネットマスク（near レイヤー用 × 5枚）

### 対象
- `le_bg_1_near.webp`
- `le_bg_2_near.webp`
- `le_bg_3_near.webp`
- `le_bg_4_near.webp`
- `le_bg_5_near.webp`

### 目的
フレーム的な効果。中央を透明にして背後の far/mid レイヤーが見えるようにし、端にシーン要素を残す。

### パラメータ
```
inner_rect: 画像の中央50% (幅50%, 高さ50%)
feather: 22%  # 柔らかいフェード
corner_boost: 1.3  # 四隅はより不透明に
```

### マスク形状
```
┌──────────────────┐
│█████████████████│  ← 端: 元の風景が見える
│███▓▓▓▓▓▓▓▓▓▓███│
│██▓▒▒▒▒▒▒▒▒▒▓██│  ← 遷移ゾーン
│██▒░░░░░░░░░▒██│
│██▒░         ░▒██│  ← 中央: 完全透明
│██▒░░░░░░░░░▒██│
│██▓▒▒▒▒▒▒▒▒▒▓██│
│███▓▓▓▓▓▓▓▓▓▓███│
│█████████████████│
└──────────────────┘
```

### アルゴリズム
1. 各ピクセルの矩形距離を計算（端からの距離）
2. X方向・Y方向それぞれの距離を算出し、独立にフェードを適用
3. 四隅は `corner_boost` で不透明度を強化
4. コサイン補間で滑らかな遷移

---

## 3. 輝度ベースアルファ（タイトル中景 × 1枚）

### 対象
- `le_title_mid.webp`

### 目的
暗い空部分を透明にし、明るい廃墟の構造物を残す。
背後の far レイヤー（星雲）が空の部分から見えるようになる。

### パラメータ
```
dark_threshold: 25    # 輝度25以下は完全透明
bright_threshold: 55  # 輝度55以上は完全不透明
補間: 線形補間
blur_pass: 2px        # マスクのジャギー低減（ガウシアンブラー）
```

### アルゴリズム
1. 画像をRGBAに変換
2. 各ピクセルの輝度を計算: `L = 0.299*R + 0.587*G + 0.114*B`
3. `L <= dark_threshold` → alpha = 0
4. `L >= bright_threshold` → alpha = 255
5. その間 → 線形補間: `alpha = (L - dark) / (bright - dark) * 255`
6. アルファチャネルにガウシアンブラー(2px)を適用してジャギーを低減

---

## 出力仕様

- 形式: WebP
- 品質: 82
- 透過: アルファチャネル付き (RGBA)
- 保存先: `src/assets/images/` に上書き
