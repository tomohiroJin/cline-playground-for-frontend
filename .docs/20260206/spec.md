# Agile Quiz Sugoroku 仕様書

## 1. 機能仕様

### 1.1 ゲームフロー

```
タイトル画面
    ↓ [Start]
スプリント開始画面
    ↓ [Begin Sprint]
クイズ画面 (7問/スプリント)
    ↓ [全問完了]
振り返り画面
    ↓ [Next Sprint / Release]
    ↓ ← (3スプリント目まで繰り返し)
結果画面
    ↓ [Play Again]
タイトル画面
```

### 1.2 ゲームルール

- **スプリント数**: 3スプリント
- **制限時間**: 15秒/問
- **問題形式**: 4択クイズ
- **スコアリング**: 正答率、速度、コンボ、技術的負債

### 1.3 イベントシステム

| イベント | アイコン | 説明 |
|----------|----------|------|
| プランニング | 📋 | 計画・合意 |
| 実装（1回目） | ⌨️ | 作り始め |
| テスト（1回目） | 🧪 | 確認 |
| リファインメント | 🔧 | 整理・調整 |
| 実装（2回目） | ⌨️ | 修正・対応 |
| テスト（2回目） | ✅ | 最終確認 |
| スプリントレビュー | 📊 | 共有・評価 |
| 緊急対応 | 🚨 | 障害対応（ランダム発生） |

### 1.4 技術的負債システム

- **不正解時に負債が蓄積**
  - 実装フェーズ: 5pt
  - テストフェーズ: 3pt
  - リファインメント: 4pt
- **負債が溜まると緊急対応イベントの発生確率が上昇**
  - 基本確率: 10%
  - 負債1ptあたり: +0.4%
  - 最大確率: 50%

### 1.5 コンボシステム

- 連続正解でコンボ数が増加
- コンボ3以上で効果音が鳴る
- 不正解でコンボリセット

### 1.6 エンジニアタイプ診断

| タイプ | 判定条件 |
|--------|----------|
| 安定運用型エンジニア | 安定度≥65%、負債≤20、正答率≥60% |
| 火消し職人エンジニア | 緊急対応成功≥2回 |
| 成長曲線型エンジニア | 初回スプリント<50%、最終スプリント≥65% |
| 高速レスポンスエンジニア | 平均速度≤5.5秒、正答率≥50% |
| 技術的負債と共に生きる人 | 負債≥35pt |
| 無難に回すエンジニア | 上記に該当しない場合 |

### 1.7 グレード評価

| グレード | スコア | ラベル |
|----------|--------|--------|
| S | 90+ | Legendary |
| A | 75+ | Excellent |
| B | 60+ | Good |
| C | 45+ | Average |
| D | 0+ | Needs Work |

スコア計算: `正答率×0.5 + 安定度×0.3 + (100-速度×8)×0.2`

## 2. 技術仕様

### 2.1 型定義

```typescript
type GamePhase = 'title' | 'sprint-start' | 'game' | 'retro' | 'result';

interface GameEvent {
  id: string;
  nm: string;
  ic: string;
  ds: string;
  color: string;
}

interface Question {
  q: string;
  o: string[];
  a: number;
}

interface GameStats {
  tc: number;      // 正解数
  tq: number;      // 総問題数
  sp: number[];    // 回答速度
  debt: number;    // 技術的負債
  emC: number;     // 緊急対応回数
  emS: number;     // 緊急対応成功数
  combo: number;   // 現在のコンボ
  maxCombo: number;// 最大コンボ
}
```

### 2.2 主要フック

| フック | 用途 |
|--------|------|
| useGame | ゲーム状態管理（フェーズ、統計、問題選択） |
| useCountdown | カウントダウンタイマー |
| useFade | フェードアニメーション制御 |
| useKeys | キーボードイベントハンドリング |

### 2.3 音声システム

- **Tone.js** を使用
- BGM: ポリシンセ（三角波）、130 BPM
- 効果音: 正解音、不正解音、タイマー音、開始音、結果音、コンボ音

## 3. UI/UX仕様

### 3.1 デザインシステム

- **カラーパレット**: ダークテーマベース（#060a12）
- **グラスモーフィズム**: backdrop-filter: blur(20px)
- **フォント**:
  - モノスペース: JetBrains Mono
  - 日本語: Noto Sans JP

### 3.2 アニメーション

| 要素 | アニメーション |
|------|---------------|
| パネル | フェードイン + スケール |
| タイマー | パルス + シェイク（5秒以下） |
| 正解/不正解 | フェードスライドイン |
| コンボ | グロー |
| グレード | 回転 + スケール |
| レーダーチャート | スケールアップ |

### 3.3 キーボード操作

- **Enter / Space**: 次へ進む
- **1-4 / A-D**: 選択肢を選択

## 4. 統合仕様

### 4.1 ルーティング

- パス: `/agile-quiz-sugoroku`
- 遅延読み込み: `lazy(() => import(...))`

### 4.2 メニューカード

- 画像: `agile_quiz_sugoroku_card_bg.webp`
- タイトル: "Agile Quiz Sugoroku"
- 説明: "アジャイル・スクラム学習クイズゲーム。3スプリントを走破し、エンジニアタイプを診断。技術的負債が溜まると緊急対応イベントが発生！"
